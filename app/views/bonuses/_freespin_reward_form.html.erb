<%
  # Set defaults for parameters
  reward ||= nil
  index ||= 0
  
  # Get existing freespin reward for editing
  existing_freespin = reward || (@bonus&.freespin_rewards&.first if @bonus&.persisted?)
  
  # Field name prefix for indexed parameters
  field_prefix = "freespin_rewards[#{index}]"
%>

<div class="card mb-3" id="freespin-reward-<%= index %>">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h6 class="mb-0">Freespin Reward #<%= index + 1 %></h6>
    <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeFreespinReward(<%= index %>)">
      <i class="fas fa-trash"></i> Remove
    </button>
  </div>
  <div class="card-body">

<!-- Основные часто используемые параметры для freespins -->
<div class="main-params-container">
  <h6 class="text-success reward-section-header">Основные параметры</h6>
  
  <!-- Games -->
  <div class="reward-param-field mb-3">
    <label for="freespin_reward_games" class="form-label">Игры (games)</label>
    <input type="text" class="form-control" name="<%= field_prefix %>[games]" id="freespin_reward_games_<%= index %>" 
            value="<%= existing_freespin&.games&.join(', ') %>">
  </div>

  <!-- Freespins Count -->
  <div class="reward-param-field mb-3">
    <label for="freespin_reward_spins_count" class="form-label">Количество фриспинов *</label>
    <input type="number" class="form-control" name="<%= field_prefix %>[spins_count]" id="freespin_reward_spins_count_<%= index %>"
           min="1" required  value="<%= existing_freespin&.spins_count %>">
  </div>

  <!-- Currency Freespin Bet Levels -->
  <%= render "currency_freespin_bet_levels", bonus: @bonus, existing_freespin: existing_freespin %>

  <!-- Bet Level -->
  <div class="reward-param-field mb-3">
    <label for="freespin_reward_bet_level" class="form-label">Уровень ставки (bet_level)</label>
    <div class="input-group">
      <input type="number" class="form-control" name="freespin_reward[bet_level]" id="freespin_reward_bet_level" 
             step="0.01" min="0"  value="<%= existing_freespin&.bet_level %>">
      <span class="input-group-text">€</span>
    </div>
  </div>



  <!-- Available -->
  <div class="reward-param-field mb-3">
    <label for="freespin_reward_available" class="form-label">Доступно (available)</label>
    <input type="number" class="form-control" name="freespin_reward[available]" id="freespin_reward_available" 
           min="0"  value="<%= existing_freespin&.available %>">
  </div>

  <!-- Code -->
  <div class="reward-param-field mb-3">
    <label for="freespin_reward_code" class="form-label">Код активации (code)</label>
    <input type="text" class="form-control" name="freespin_reward[code]" id="freespin_reward_code" 
            value="<%= existing_freespin&.code %>">
  </div>

</div>

<!-- Дополнительные параметры -->
<div class="mt-4">
  <button type="button" class="btn btn-outline-secondary btn-sm" id="toggle_freespin_advanced" 
          onclick="toggleAdvancedFreespinParams()">
    <i class="fas fa-plus"></i> Показать дополнительные параметры
  </button>
  
  <div id="freespin_advanced_params" class="collapse mt-3">
    <div class="card">
      <div class="card-header">
        <h6 class="card-title mb-0">Дополнительные параметры</h6>
      </div>
      <div class="card-body">
        <div class="advanced-params-container">
          <div class="reward-param-field mb-3">
            <label for="freespin_reward_auto_activate" class="form-label">Автоактивация</label>
            <select class="form-select" name="freespin_reward[auto_activate]" id="freespin_reward_auto_activate">
              <option value="">Не задано</option>
              <option value="true" <%= 'selected' if existing_freespin&.get_advanced_param('auto_activate') == true %>>Да</option>
              <option value="false" <%= 'selected' if existing_freespin&.get_advanced_param('auto_activate') == false %>>Нет</option>
            </select>
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_duration" class="form-label">Длительность</label>
            <input type="text" class="form-control" name="freespin_reward[duration]" 
                   id="freespin_reward_duration"  
                   value="<%= existing_freespin&.get_advanced_param('duration') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_activation_duration" class="form-label">Время активации</label>
            <input type="text" class="form-control" name="freespin_reward[activation_duration]" 
                   id="freespin_reward_activation_duration"  
                   value="<%= existing_freespin&.get_advanced_param('activation_duration') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_email_template" class="form-label">Email шаблон</label>
            <input type="text" class="form-control" name="freespin_reward[email_template]" 
                   id="freespin_reward_email_template"  
                   value="<%= existing_freespin&.get_advanced_param('email_template') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_range" class="form-label">Диапазон (range)</label>
            <input type="text" class="form-control" name="freespin_reward[range]" 
                   id="freespin_reward_range"  
                   value="<%= existing_freespin&.get_advanced_param('range') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_last_login_country" class="form-label">Страна последнего входа</label>
            <input type="text" class="form-control" name="freespin_reward[last_login_country]" 
                   id="freespin_reward_last_login_country"  
                   value="<%= existing_freespin&.get_advanced_param('last_login_country') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_profile_country" class="form-label">Страна профиля</label>
            <input type="text" class="form-control" name="freespin_reward[profile_country]" 
                   id="freespin_reward_profile_country"  
                   value="<%= existing_freespin&.get_advanced_param('profile_country') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_current_ip_country" class="form-label">Страна текущего IP</label>
            <input type="text" class="form-control" name="freespin_reward[current_ip_country]" 
                   id="freespin_reward_current_ip_country"  
                   value="<%= existing_freespin&.get_advanced_param('current_ip_country') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_emails" class="form-label">Email адреса</label>
            <input type="text" class="form-control" name="freespin_reward[emails]" 
                   id="freespin_reward_emails"  
                   value="<%= existing_freespin&.get_advanced_param('emails') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_deposit_payment_systems" class="form-label">Платежные системы депозита</label>
            <input type="text" class="form-control" name="freespin_reward[deposit_payment_systems]" 
                   id="freespin_reward_deposit_payment_systems"  
                   value="<%= existing_freespin&.get_advanced_param('deposit_payment_systems') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_cashout_payment_systems" class="form-label">Платежные системы вывода</label>
            <input type="text" class="form-control" name="freespin_reward[cashout_payment_systems]" 
                   id="freespin_reward_cashout_payment_systems"  
                   value="<%= existing_freespin&.get_advanced_param('cashout_payment_systems') %>">
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_user_can_have_duplicates" class="form-label">Дубликаты пользователям</label>
            <select class="form-select" name="freespin_reward[user_can_have_duplicates]" id="freespin_reward_user_can_have_duplicates">
              <option value="">Не задано</option>
              <option value="true" <%= 'selected' if existing_freespin&.get_advanced_param('user_can_have_duplicates') == true %>>Да</option>
              <option value="false" <%= 'selected' if existing_freespin&.get_advanced_param('user_can_have_duplicates') == false %>>Нет</option>
            </select>
          </div>

          <div class="reward-param-field mb-3">
            <label for="freespin_reward_user_can_have_disposable_email" class="form-label">Одноразовые email</label>
            <select class="form-select" name="freespin_reward[user_can_have_disposable_email]" id="freespin_reward_user_can_have_disposable_email">
              <option value="">Не задано</option>
              <option value="true" <%= 'selected' if existing_freespin&.get_advanced_param('user_can_have_disposable_email') == true %>>Разрешить</option>
                <option value="false" <%= 'selected' if existing_freespin&.get_advanced_param('user_can_have_disposable_email') == false %>>Запретить</option>
              </select>
            </div>
          </div>

          <div class="col-md-6">
            <div class="mb-3">
              <label for="freespin_reward_total_deposits" class="form-label">Общие депозиты</label>
              <input type="number" class="form-control" name="freespin_reward[total_deposits]" 
                     id="freespin_reward_total_deposits" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('total_deposits') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_deposits_sum" class="form-label">Сумма депозитов</label>
              <input type="number" class="form-control" name="freespin_reward[deposits_sum]" 
                     id="freespin_reward_deposits_sum" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('deposits_sum') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_loss_sum" class="form-label">Сумма проигрышей</label>
              <input type="number" class="form-control" name="freespin_reward[loss_sum]" 
                     id="freespin_reward_loss_sum" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('loss_sum') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_deposits_count" class="form-label">Количество депозитов</label>
              <input type="number" class="form-control" name="freespin_reward[deposits_count]" 
                     id="freespin_reward_deposits_count" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('deposits_count') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_spend_sum" class="form-label">Сумма трат</label>
              <input type="number" class="form-control" name="freespin_reward[spend_sum]" 
                     id="freespin_reward_spend_sum" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('spend_sum') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_category_loss_sum" class="form-label">Проигрыши по категории</label>
              <input type="number" class="form-control" name="freespin_reward[category_loss_sum]" 
                     id="freespin_reward_category_loss_sum" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('category_loss_sum') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_wager_sum" class="form-label">Сумма вагера</label>
              <input type="number" class="form-control" name="freespin_reward[wager_sum]" 
                     id="freespin_reward_wager_sum" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('wager_sum') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_bets_count" class="form-label">Количество ставок</label>
              <input type="number" class="form-control" name="freespin_reward[bets_count]" 
                     id="freespin_reward_bets_count" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('bets_count') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_affiliates_user" class="form-label">Пользователь партнера</label>
              <input type="text" class="form-control" name="freespin_reward[affiliates_user]" 
                     id="freespin_reward_affiliates_user" 
                     value="<%= existing_freespin&.get_advanced_param('affiliates_user') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_balance" class="form-label">Баланс</label>
              <input type="number" class="form-control" name="freespin_reward[balance]" 
                     id="freespin_reward_balance" step="0.01" 
                     value="<%= existing_freespin&.get_advanced_param('balance') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_chargeable_comp_points" class="form-label">Списываемые комп-поинты</label>
              <input type="number" class="form-control" name="freespin_reward[chargeable_comp_points]" 
                     id="freespin_reward_chargeable_comp_points" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('chargeable_comp_points') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_persistent_comp_points" class="form-label">Постоянные комп-поинты</label>
              <input type="number" class="form-control" name="freespin_reward[persistent_comp_points]" 
                     id="freespin_reward_persistent_comp_points" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('persistent_comp_points') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_date_of_birth" class="form-label">Дата рождения</label>
              <input type="date" class="form-control" name="freespin_reward[date_of_birth]" 
                     id="freespin_reward_date_of_birth" 
                     value="<%= existing_freespin&.get_advanced_param('date_of_birth') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_deposit" class="form-label">Депозит</label>
              <input type="number" class="form-control" name="freespin_reward[deposit]" 
                     id="freespin_reward_deposit" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('deposit') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_gender" class="form-label">Пол</label>
              <select class="form-select" name="freespin_reward[gender]" id="freespin_reward_gender">
                <option value="">Не задано</option>
                <option value="male" <%= 'selected' if existing_freespin&.get_advanced_param('gender') == 'male' %>>Мужской</option>
                <option value="female" <%= 'selected' if existing_freespin&.get_advanced_param('gender') == 'female' %>>Женский</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="freespin_reward_issued_bonus" class="form-label">Выданный бонус</label>
              <input type="text" class="form-control" name="freespin_reward[issued_bonus]" 
                     id="freespin_reward_issued_bonus" 
                     value="<%= existing_freespin&.get_advanced_param('issued_bonus') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_registered" class="form-label">Зарегистрирован</label>
              <input type="date" class="form-control" name="freespin_reward[registered]" 
                     id="freespin_reward_registered" 
                     value="<%= existing_freespin&.get_advanced_param('registered') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_social_networks" class="form-label">Социальные сети</label>
              <input type="text" class="form-control" name="freespin_reward[social_networks]" 
                     id="freespin_reward_social_networks"  
                     value="<%= existing_freespin&.get_advanced_param('social_networks') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_wager_done" class="form-label">Отыгрыш выполнен</label>
              <select class="form-select" name="freespin_reward[wager_done]" id="freespin_reward_wager_done">
                <option value="">Не задано</option>
                <option value="true" <%= 'selected' if existing_freespin&.get_advanced_param('wager_done') == true %>>Да</option>
                <option value="false" <%= 'selected' if existing_freespin&.get_advanced_param('wager_done') == false %>>Нет</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="freespin_reward_hold_min" class="form-label">Hold min</label>
              <input type="number" class="form-control" name="freespin_reward[hold_min]" 
                     id="freespin_reward_hold_min" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('hold_min') %>">
            </div>

            <div class="mb-3">
              <label for="freespin_reward_hold_max" class="form-label">Hold max</label>
              <input type="number" class="form-control" name="freespin_reward[hold_max]" 
                     id="freespin_reward_hold_max" step="0.01" min="0" 
                     value="<%= existing_freespin&.get_advanced_param('hold_max') %>">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function toggleAdvancedFreespinParams() {
  const advancedSection = document.getElementById('freespin_advanced_params');
  const toggleButton = document.getElementById('toggle_freespin_advanced');
  
  if (advancedSection.classList.contains('show')) {
    advancedSection.classList.remove('show');
    toggleButton.innerHTML = '<i class="fas fa-plus"></i> Показать дополнительные параметры';
  } else {
    advancedSection.classList.add('show');
    toggleButton.innerHTML = '<i class="fas fa-minus"></i> Скрыть дополнительные параметры';
  }
}
</script>
  </div>
</div>
