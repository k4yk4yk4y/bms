<% if @permanent_bonus_previews.present? %>
  <div class="mb-4">
    <h3 class="h4 mb-3">
      <i class="fas fa-star"></i> Permanent Bonuses Preview
      <% if params[:project].present? %>
        <span class="badge bg-primary ms-2"><%= params[:project] %></span>
      <% end %>
    </h3>
    
    <div class="row g-2">
      <% @permanent_bonus_previews.each do |bonus_preview| %>
        <div class="col-xl-3 col-lg-4 col-md-6">
          <div class="card permanent-bonus-card <%= bonus_preview[:existing_bonus] ? 'active-bonus' : 'missing-bonus' %>">
            <div class="card-body d-flex flex-column text-center">
              <div class="bonus-status-indicator mb-2">
                <% if bonus_preview[:existing_bonus] %>
                  <i class="fas fa-check-circle text-success"></i>
                <% else %>
                  <i class="fas fa-plus-circle text-warning"></i>
                <% end %>
              </div>
              
              <h6 class="card-title mb-2 fw-bold">
                <%= bonus_preview[:name] %>
              </h6>
              
              <% if bonus_preview[:existing_bonus] && bonus_preview[:existing_bonus].description.present? %>
                <p class="card-text small text-muted flex-grow-1 mb-3">
                  <%= bonus_preview[:existing_bonus].description %>
                </p>
              <% else %>
                <div class="flex-grow-1 mb-3"></div>
              <% end %>
              
              <div class="mt-auto">
                <% if bonus_preview[:existing_bonus] %>
                  <div class="btn-group w-100" role="group">
                    <%= link_to bonus_path(bonus_preview[:existing_bonus]), 
                        class: "btn btn-outline-primary btn-sm", 
                        title: "View Details" do %>
                      <i class="fas fa-eye"></i>
                    <% end %>
                    <% if can?(:update, bonus_preview[:existing_bonus]) %>
                      <%= link_to edit_bonus_path(bonus_preview[:existing_bonus]), 
                          class: "btn btn-primary btn-sm",
                          title: "Edit Bonus" do %>
                        <i class="fas fa-edit"></i>
                      <% end %>
                    <% end %>
                  </div>
                <% else %>
                  <% if can?(:create, Bonus) %>
                    <%= link_to new_bonus_path(event: 'deposit', dsl_tag: bonus_preview[:dsl_tag], name: bonus_preview[:name]), 
                        class: "btn btn-success btn-sm w-100",
                        title: "Create #{bonus_preview[:name]}" do %>
                      <i class="fas fa-plus"></i> Create
                    <% end %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<style>
.permanent-bonus-card {
  background-color: #ffffff !important;
  border: 1px solid #dee2e6 !important;
  border-radius: 0.375rem;
  transition: all 0.2s ease-in-out;
  position: relative;
  overflow: hidden;
  height: 180px; /* Compact height */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.permanent-bonus-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  border-color: #adb5bd !important;
}

.permanent-bonus-card.active-bonus {
  border-left: 4px solid #28a745 !important;
}

.permanent-bonus-card.active-bonus:hover {
  border-left: 4px solid #20c997 !important;
}

.permanent-bonus-card.missing-bonus {
  border-left: 4px solid #ffc107 !important;
}

.permanent-bonus-card.missing-bonus:hover {
  border-left: 4px solid #ffca2c !important;
}

.permanent-bonus-card .card-body {
  height: 100%;
  padding: 1rem 0.75rem;
}

.permanent-bonus-card .bonus-status-indicator {
  font-size: 1.1rem;
}

.permanent-bonus-card .card-title {
  font-size: 0.9rem;
  line-height: 1.2;
  color: #212529 !important;
  margin-bottom: 0.5rem;
}

.permanent-bonus-card .card-text {
  font-size: 0.8rem;
  line-height: 1.3;
  color: #6c757d !important;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.permanent-bonus-card .btn-sm {
  font-size: 0.75rem;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
}

.permanent-bonus-card .btn-outline-primary {
  border-color: #0d6efd;
  color: #0d6efd;
}

.permanent-bonus-card .btn-outline-primary:hover {
  background-color: #0d6efd;
  border-color: #0d6efd;
  color: #fff;
}

.permanent-bonus-card .btn-primary {
  background-color: #0d6efd;
  border-color: #0d6efd;
  color: #fff;
}

.permanent-bonus-card .btn-primary:hover {
  background-color: #0b5ed7;
  border-color: #0a58ca;
}

.permanent-bonus-card .btn-success {
  background-color: #198754;
  border-color: #198754;
  color: #fff;
}

.permanent-bonus-card .btn-success:hover {
  background-color: #157347;
  border-color: #146c43;
}

/* Responsive adjustments */
@media (max-width: 1200px) {
  .permanent-bonus-card {
    height: 170px;
  }
}

@media (max-width: 768px) {
  .permanent-bonus-card {
    height: 160px;
  }
  
  .permanent-bonus-card .card-title {
    font-size: 0.85rem;
  }
  
  .permanent-bonus-card .card-text {
    font-size: 0.75rem;
    -webkit-line-clamp: 2;
  }
  
  .permanent-bonus-card .card-body {
    padding: 0.75rem 0.5rem;
  }
}

@media (max-width: 576px) {
  .permanent-bonus-card {
    height: 150px;
  }
}

/* Subtle hover effect */
.permanent-bonus-card:hover {
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}
</style>

