<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0"><%= @retention_email.display_subject %></h1>
    <div class="d-flex gap-2">
      <% if can?(:update, @retention_email) %>
        <%= link_to "Edit", edit_retention_chain_retention_email_path(@retention_chain, @retention_email),
                    class: "btn btn-outline-primary" %>
      <% end %>
      <%= link_to "Back", retention_chain_path(@retention_chain), class: "btn btn-outline-secondary" %>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <dl class="row mb-0">
        <dt class="col-sm-3">Status</dt>
        <dd class="col-sm-9"><%= @retention_email.status.humanize %></dd>
        <dt class="col-sm-3">Launch date</dt>
        <dd class="col-sm-9"><%= @retention_email.launch_date&.strftime("%Y-%m-%d %H:%M") || "—" %></dd>
        <dt class="col-sm-3">Header</dt>
        <dd class="col-sm-9"><%= @retention_email.header.presence || "—" %></dd>
        <dt class="col-sm-3">Preheader</dt>
        <dd class="col-sm-9"><%= @retention_email.preheader.presence || "—" %></dd>
        <dt class="col-sm-3">Timing</dt>
        <dd class="col-sm-9"><%= @retention_email.send_timing.presence || "—" %></dd>
        <dt class="col-sm-3">Description</dt>
        <dd class="col-sm-9"><%= @retention_email.description.presence || "—" %></dd>
        <dt class="col-sm-3">Text</dt>
        <dd class="col-sm-9"><%= simple_format(@retention_email.body.presence || "—") %></dd>
        <dt class="col-sm-3">Bonuses</dt>
        <dd class="col-sm-9">
          <% if @retention_email.bonuses.any? %>
            <% @retention_email.bonuses.each do |bonus| %>
              <% label = bonus.name.presence || "Bonus ##{bonus.id}" %>
              <% label = bonus.code.present? ? "#{label} (#{bonus.code})" : label %>
              <%= link_to label, bonus_path(bonus), class: "badge bg-info text-dark me-1" %>
            <% end %>
          <% else %>
            <span class="text-muted">—</span>
          <% end %>
        </dd>
      </dl>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h2 class="h6">Images</h2>
      <% if @retention_email.images.attached? %>
        <div class="d-flex flex-wrap gap-2">
          <% @retention_email.images.each do |image| %>
            <%= link_to url_for(image), target: "_blank" do %>
              <%= image_tag url_for(image), class: "img-thumbnail", style: "max-width: 240px;" %>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <p class="text-muted mb-0">No images uploaded.</p>
      <% end %>
    </div>
  </div>
</div>
