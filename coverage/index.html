<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Mbs cbm</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.2/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.2/favicon_red.png" />
  </head>

  <body>
    <div id="loading">
      <img src="./assets/0.13.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2025-08-20T15:06:46+03:00">2025-08-20T15:06:46+03:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="red">
  75.22%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         117.44
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>22</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>1340</b> relevant lines,
    <span class="green"><b>1008</b> lines covered</span> and
    <span class="red"><b>332</b> lines missed. </span>
    (<span class="red">
  75.22%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9703e28964dc4b8f58cb9615fa2771bf2cc5587d" class="src_link" title="app/controllers/api/v1/bonuses_controller.rb">app/controllers/api/v1/bonuses_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">76.36 %</td>
            <td class="cell--number">241</td>
            <td class="cell--number">110</td>
            <td class="cell--number">84</td>
            <td class="cell--number">26</td>
            <td class="cell--number">9.05</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#83f0980b10577f55e90e78d5632e43711a443fd8" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#005d5b77512b65cea7c12f999849fcfe0d4301c3" class="src_link" title="app/controllers/bonuses_controller.rb">app/controllers/bonuses_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">43.01 %</td>
            <td class="cell--number">972</td>
            <td class="cell--number">465</td>
            <td class="cell--number">200</td>
            <td class="cell--number">265</td>
            <td class="cell--number">3.18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c24910a7541c46d497a3f31df3c87eb4bf04173f" class="src_link" title="app/controllers/heatmap_controller.rb">app/controllers/heatmap_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.70 %</td>
            <td class="cell--number">98</td>
            <td class="cell--number">43</td>
            <td class="cell--number">39</td>
            <td class="cell--number">4</td>
            <td class="cell--number">208.81</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c46b5057ab25e6d1b989cf8ff249b7d05f400cbb" class="src_link" title="app/controllers/marketing_controller.rb">app/controllers/marketing_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.21 %</td>
            <td class="cell--number">132</td>
            <td class="cell--number">56</td>
            <td class="cell--number">55</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.64</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5237a72b5ef69814d2861c455d17dd2016016380" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#40c4f1eddb18070c25dfaa7b9c83372ab3438581" class="src_link" title="app/helpers/bonuses_helper.rb">app/helpers/bonuses_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">139</td>
            <td class="cell--number">36</td>
            <td class="cell--number">36</td>
            <td class="cell--number">0</td>
            <td class="cell--number">10.33</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9bc355a30dd9a82aae4a5459eeba9148803f540d" class="src_link" title="app/helpers/heatmap_helper.rb">app/helpers/heatmap_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.83 %</td>
            <td class="cell--number">57</td>
            <td class="cell--number">24</td>
            <td class="cell--number">23</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.29</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#67ebc1fc17228ec657daca77f855b586eae4cbd4" class="src_link" title="app/helpers/marketing_helper.rb">app/helpers/marketing_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">29</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0</td>
            <td class="cell--number">40.59</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#75ab4ba964731c00f4d25b18bec5b1d0ff7e1a7b" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7d5d68ba9fbd67851e6eefe5745845e97302ed4c" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#290be0e57251fc6bc1e5545ea37ea65d8e750721" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#77d0c87e180a58e19ad08c928ae3126d60aa0698" class="src_link" title="app/models/bonus.rb">app/models/bonus.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.20 %</td>
            <td class="cell--number">390</td>
            <td class="cell--number">204</td>
            <td class="cell--number">184</td>
            <td class="cell--number">20</td>
            <td class="cell--number">580.65</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2f52720eb3f56f0fa41e109b3ef60478bea5a3f9" class="src_link" title="app/models/bonus_buy_reward.rb">app/models/bonus_buy_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.65 %</td>
            <td class="cell--number">135</td>
            <td class="cell--number">63</td>
            <td class="cell--number">59</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2.52</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a777f8a6a614411f55fcd3e36ce41370addae820" class="src_link" title="app/models/bonus_code_reward.rb">app/models/bonus_code_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">42</td>
            <td class="cell--number">20</td>
            <td class="cell--number">20</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.50</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ade511c40c23e547c83bcfe738a77cfca3098cc0" class="src_link" title="app/models/bonus_reward.rb">app/models/bonus_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">106</td>
            <td class="cell--number">49</td>
            <td class="cell--number">49</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.02</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b8e2696113241e24e85f73a908b0fadf1f122933" class="src_link" title="app/models/comp_point_reward.rb">app/models/comp_point_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">19</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.58</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f6b4379cb0a0655d542b4c26faa4a1ff687354cf" class="src_link" title="app/models/concerns/bonus_common_parameters.rb">app/models/concerns/bonus_common_parameters.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">68</td>
            <td class="cell--number">30</td>
            <td class="cell--number">30</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.50</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d6a1c9bbd628e883c66514003d4ddfd1cb09697f" class="src_link" title="app/models/freechip_reward.rb">app/models/freechip_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.82</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c570f2c9548c1e04e0437d09387b88c19a154567" class="src_link" title="app/models/freespin_reward.rb">app/models/freespin_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.33 %</td>
            <td class="cell--number">130</td>
            <td class="cell--number">60</td>
            <td class="cell--number">56</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2.67</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5a79d8d41e9da51fbb20179b312e2cda8c4ea3d1" class="src_link" title="app/models/marketing_request.rb">app/models/marketing_request.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.00 %</td>
            <td class="cell--number">214</td>
            <td class="cell--number">100</td>
            <td class="cell--number">99</td>
            <td class="cell--number">1</td>
            <td class="cell--number">241.83</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#746251adf3fce651fef008adcb58338f2b2ec9a9" class="src_link" title="app/models/material_prize_reward.rb">app/models/material_prize_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">10</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7.90</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent">
      <span class="red">
  56.21%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         17.91
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Controllers"></a>

  <div>
    <b>5</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>676</b> relevant lines,
    <span class="green"><b>380</b> lines covered</span> and
    <span class="red"><b>296</b> lines missed. </span>
    (<span class="red">
  56.21%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9703e28964dc4b8f58cb9615fa2771bf2cc5587d" class="src_link" title="app/controllers/api/v1/bonuses_controller.rb">app/controllers/api/v1/bonuses_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">76.36 %</td>
            <td class="cell--number">241</td>
            <td class="cell--number">110</td>
            <td class="cell--number">84</td>
            <td class="cell--number">26</td>
            <td class="cell--number">9.05</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#83f0980b10577f55e90e78d5632e43711a443fd8" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#005d5b77512b65cea7c12f999849fcfe0d4301c3" class="src_link" title="app/controllers/bonuses_controller.rb">app/controllers/bonuses_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">43.01 %</td>
            <td class="cell--number">972</td>
            <td class="cell--number">465</td>
            <td class="cell--number">200</td>
            <td class="cell--number">265</td>
            <td class="cell--number">3.18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c24910a7541c46d497a3f31df3c87eb4bf04173f" class="src_link" title="app/controllers/heatmap_controller.rb">app/controllers/heatmap_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.70 %</td>
            <td class="cell--number">98</td>
            <td class="cell--number">43</td>
            <td class="cell--number">39</td>
            <td class="cell--number">4</td>
            <td class="cell--number">208.81</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c46b5057ab25e6d1b989cf8ff249b7d05f400cbb" class="src_link" title="app/controllers/marketing_controller.rb">app/controllers/marketing_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.21 %</td>
            <td class="cell--number">132</td>
            <td class="cell--number">56</td>
            <td class="cell--number">55</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.64</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Channels">
  <h2>
    <span class="group_name">Channels</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Channels"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent">
      <span class="green">
  94.89%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         252.53
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Models"></a>

  <div>
    <b>11</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>568</b> relevant lines,
    <span class="green"><b>539</b> lines covered</span> and
    <span class="red"><b>29</b> lines missed. </span>
    (<span class="green">
  94.89%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#290be0e57251fc6bc1e5545ea37ea65d8e750721" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#77d0c87e180a58e19ad08c928ae3126d60aa0698" class="src_link" title="app/models/bonus.rb">app/models/bonus.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.20 %</td>
            <td class="cell--number">390</td>
            <td class="cell--number">204</td>
            <td class="cell--number">184</td>
            <td class="cell--number">20</td>
            <td class="cell--number">580.65</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2f52720eb3f56f0fa41e109b3ef60478bea5a3f9" class="src_link" title="app/models/bonus_buy_reward.rb">app/models/bonus_buy_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.65 %</td>
            <td class="cell--number">135</td>
            <td class="cell--number">63</td>
            <td class="cell--number">59</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2.52</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a777f8a6a614411f55fcd3e36ce41370addae820" class="src_link" title="app/models/bonus_code_reward.rb">app/models/bonus_code_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">42</td>
            <td class="cell--number">20</td>
            <td class="cell--number">20</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.50</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ade511c40c23e547c83bcfe738a77cfca3098cc0" class="src_link" title="app/models/bonus_reward.rb">app/models/bonus_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">106</td>
            <td class="cell--number">49</td>
            <td class="cell--number">49</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.02</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b8e2696113241e24e85f73a908b0fadf1f122933" class="src_link" title="app/models/comp_point_reward.rb">app/models/comp_point_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">19</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.58</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f6b4379cb0a0655d542b4c26faa4a1ff687354cf" class="src_link" title="app/models/concerns/bonus_common_parameters.rb">app/models/concerns/bonus_common_parameters.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">68</td>
            <td class="cell--number">30</td>
            <td class="cell--number">30</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.50</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d6a1c9bbd628e883c66514003d4ddfd1cb09697f" class="src_link" title="app/models/freechip_reward.rb">app/models/freechip_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.82</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c570f2c9548c1e04e0437d09387b88c19a154567" class="src_link" title="app/models/freespin_reward.rb">app/models/freespin_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.33 %</td>
            <td class="cell--number">130</td>
            <td class="cell--number">60</td>
            <td class="cell--number">56</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2.67</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5a79d8d41e9da51fbb20179b312e2cda8c4ea3d1" class="src_link" title="app/models/marketing_request.rb">app/models/marketing_request.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.00 %</td>
            <td class="cell--number">214</td>
            <td class="cell--number">100</td>
            <td class="cell--number">99</td>
            <td class="cell--number">1</td>
            <td class="cell--number">241.83</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#746251adf3fce651fef008adcb58338f2b2ec9a9" class="src_link" title="app/models/material_prize_reward.rb">app/models/material_prize_reward.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">10</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7.90</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Mailers"></a>

  <div>
    <b>1</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>4</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>4</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7d5d68ba9fbd67851e6eefe5745845e97302ed4c" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent">
      <span class="green">
  98.89%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         20.23
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Helpers"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>90</b> relevant lines,
    <span class="green"><b>89</b> lines covered</span> and
    <span class="red"><b>1</b> lines missed. </span>
    (<span class="green">
  98.89%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5237a72b5ef69814d2861c455d17dd2016016380" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#40c4f1eddb18070c25dfaa7b9c83372ab3438581" class="src_link" title="app/helpers/bonuses_helper.rb">app/helpers/bonuses_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">139</td>
            <td class="cell--number">36</td>
            <td class="cell--number">36</td>
            <td class="cell--number">0</td>
            <td class="cell--number">10.33</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9bc355a30dd9a82aae4a5459eeba9148803f540d" class="src_link" title="app/helpers/heatmap_helper.rb">app/helpers/heatmap_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.83 %</td>
            <td class="cell--number">57</td>
            <td class="cell--number">24</td>
            <td class="cell--number">23</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.29</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#67ebc1fc17228ec657daca77f855b586eae4cbd4" class="src_link" title="app/helpers/marketing_helper.rb">app/helpers/marketing_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">29</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0</td>
            <td class="cell--number">40.59</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Jobs"></a>

  <div>
    <b>1</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>2</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>2</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#75ab4ba964731c00f4d25b18bec5b1d0ff7e1a7b" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Libraries"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Views">
  <h2>
    <span class="group_name">Views</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Views"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.2<br/>
        using RSpec
      </div>

      <div class="source_files">
      
        <div class="source_table" id="9703e28964dc4b8f58cb9615fa2771bf2cc5587d">
  <div class="header">
    <h3>app/controllers/api/v1/bonuses_controller.rb</h3>
    <h4>
      <span class="red">
  76.36%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>110</b> relevant lines.
      <span class="green"><b>84</b> lines covered</span> and
      <span class="red"><b>26</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class Api::V1::BonusesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_bonus, only: [ :show, :update, :destroy ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">  # Skip CSRF protection for API endpoints</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  skip_before_action :verify_authenticity_token</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">  # GET /api/v1/bonuses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="9">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">    @bonuses = Bonus.includes(:bonus_rewards, :freespin_rewards, :bonus_buy_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">                             :freechip_rewards, :bonus_code_rewards, :material_prize_rewards, :comp_point_rewards)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    # Apply filters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="13">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    @bonuses = apply_filters(@bonuses)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">    # Pagination</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="16">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    page = [ (params[:page] || 1).to_i, 1 ].max  # Ensure page is at least 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="17">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    per_page = [ (params[:per_page] || 20).to_i, 100 ].min</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="18">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    per_page = [ per_page, 1 ].max  # Ensure per_page is at least 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="19">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    offset = [ (page - 1) * per_page, 0 ].max  # Ensure offset is not negative</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="21">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    total_count = @bonuses.count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="22">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    @bonuses = @bonuses.limit(per_page).offset(offset)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="24">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    render json: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">              bonuses: @bonuses.as_json(include: bonus_includes, except: [ :currency ]),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">      pagination: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">        current_page: page,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">        per_page: per_page,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">        total_count: total_count,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="30">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">        total_pages: (total_count.to_f / per_page).ceil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">  # GET /api/v1/bonuses/1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="37">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    render json: @bonus.as_json(include: bonus_includes, except: [ :currency ])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">  # POST /api/v1/bonuses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="42">
            
              <span class="hits">19</span>
            

            

            <code class="ruby">    @bonus = Bonus.new(bonus_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="43">
            
              <span class="hits">19</span>
            

            

            <code class="ruby">    clean_inappropriate_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="45">
            
              <span class="hits">19</span>
            

            

            <code class="ruby">    if @bonus.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="46">
            
              <span class="hits">13</span>
            

            

            <code class="ruby">      create_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="47">
            
              <span class="hits">13</span>
            

            

            <code class="ruby">      update_type_specific_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="48">
            
              <span class="hits">13</span>
            

            

            <code class="ruby">      render json: @bonus.as_json(include: bonus_includes, except: [ :currency ]), status: :created</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="50">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      render json: { errors: @bonus.errors }, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby">  rescue ActiveRecord::RecordInvalid =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            

            <code class="ruby">    render json: { errors: e.record.errors }, status: :unprocessable_entity unless performed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">  # PATCH/PUT /api/v1/bonuses/1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="58">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">    @bonus.assign_attributes(bonus_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="59">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">    clean_inappropriate_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="61">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">    if @bonus.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="62">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      update_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="63">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      update_type_specific_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="64">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      render json: @bonus.as_json(include: bonus_includes, except: [ :currency ])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="66">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      render json: { errors: @bonus.errors }, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby">  # DELETE /api/v1/bonuses/1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="72">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @bonus.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="73">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    head :no_content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">  # GET /api/v1/bonuses/by_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="79">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def by_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="80">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    @bonuses = Bonus.by_event(params[:type]) if params[:type].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="81">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    @bonuses ||= Bonus.none</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="83">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    render json: @bonuses.as_json(include: bonus_includes, except: [ :currency ])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby">  # GET /api/v1/bonuses/active</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def active</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="88">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    @bonuses = Bonus.active.available_now</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">                    .includes(:bonus_rewards, :freespin_rewards, :bonus_buy_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby">                             :freechip_rewards, :bonus_code_rewards, :material_prize_rewards, :comp_point_rewards)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="92">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    render json: @bonuses.as_json(include: bonus_includes, except: [ :currency ])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby">  # GET /api/v1/bonuses/expired</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def expired</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="97">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    @bonuses = Bonus.expired</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            

            <code class="ruby">                    .includes(:bonus_rewards, :freespin_rewards, :bonus_buy_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            

            <code class="ruby">                             :freechip_rewards, :bonus_code_rewards, :material_prize_rewards, :comp_point_rewards)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="101">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    render json: @bonuses.as_json(include: bonus_includes, except: [ :currency ])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="106">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_bonus</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="107">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @bonus = Bonus.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            

            <code class="ruby">  rescue ActiveRecord::RecordNotFound</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="109">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    render json: { error: &quot;Bonus not found&quot; }, status: :not_found</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="112">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="113">
            
              <span class="hits">31</span>
            

            

            <code class="ruby">    params.require(:bonus).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby">      :name, :code, :event, :status, :minimum_deposit, :wager,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            

            <code class="ruby">      :maximum_winnings, :wagering_strategy, :availability_start_date,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            

            <code class="ruby">      :availability_end_date, :user_group, :tags, :country, :currency,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            

            <code class="ruby">      :project, :dsl_tag, :created_by, :updated_by, :description,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            

            <code class="ruby">      :no_more, :totally_no_more, currencies: [], groups: [], currency_minimum_deposits: {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="122">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def type_specific_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            

            <code class="ruby">    # Return empty hash since we now use reward associations instead of type-specific params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            

            

            <code class="ruby">    {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="127">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby">    # Create bonus reward if parameters provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="129">
            
              <span class="hits">22</span>
            

            

            <code class="ruby">    if params[:bonus_reward].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            

            

            <code class="ruby">      reward = @bonus.bonus_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            

            

            <code class="ruby">      reward.reward_type = &quot;bonus&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            

            

            <code class="ruby">      reward.amount = params[:bonus_reward][:amount]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            

            

            <code class="ruby">      reward.percentage = params[:bonus_reward][:percentage]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            

            

            <code class="ruby">      reward.config = params[:bonus_reward][:config] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="136">
            
              <span class="hits">22</span>
            

            

            <code class="ruby">    elsif params[:bonus] &amp;&amp; params[:bonus][:bonus_reward].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="137">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      reward = @bonus.bonus_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="138">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      reward.reward_type = &quot;bonus&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="139">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      reward.amount = params[:bonus][:bonus_reward][:amount]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="140">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      reward.percentage = params[:bonus][:bonus_reward][:percentage]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="141">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      reward.config = params[:bonus][:bonus_reward][:config] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            

            <code class="ruby">    # Create freespin reward if parameters provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="146">
            
              <span class="hits">22</span>
            

            

            <code class="ruby">    if params[:freespin_reward].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            

            

            <code class="ruby">      reward = @bonus.freespin_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            

            

            <code class="ruby">      reward.spins_count = params[:freespin_reward][:spins_count]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            

            

            <code class="ruby">      reward.game_restrictions = params[:freespin_reward][:game_restrictions]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            

            

            <code class="ruby">      reward.config = params[:freespin_reward][:config] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="152">
            
              <span class="hits">22</span>
            

            

            <code class="ruby">    elsif params[:bonus] &amp;&amp; params[:bonus][:freespin_reward].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="153">
            

            

            <code class="ruby">      reward = @bonus.freespin_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="154">
            

            

            <code class="ruby">      reward.spins_count = params[:bonus][:freespin_reward][:spins_count]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="155">
            

            

            <code class="ruby">      reward.game_restrictions = params[:bonus][:freespin_reward][:game_restrictions]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            

            

            <code class="ruby">      reward.config = params[:bonus][:freespin_reward][:config] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="161">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            

            <code class="ruby">    # Update or create rewards based on provided parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="163">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    create_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="166">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_includes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            

            <code class="ruby">    # Return all reward associations for JSON inclusion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="67" data-linenumber="168">
            
              <span class="hits">67</span>
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            

            <code class="ruby">      :bonus_rewards, :freespin_rewards, :bonus_buy_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            

            <code class="ruby">      :freechip_rewards, :bonus_code_rewards, :material_prize_rewards, :comp_point_rewards</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="174">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_type_associations</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="175">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            

            <code class="ruby">      :bonus_rewards, :freespin_rewards, :bonus_buy_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            

            <code class="ruby">      :freechip_rewards, :bonus_code_rewards, :material_prize_rewards, :comp_point_rewards</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="181">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def apply_filters(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            

            <code class="ruby">    # Filter by event type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="183">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    scope = scope.by_event(params[:type]) if params[:type].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            

            <code class="ruby">    # Filter by status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="186">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    case params[:status]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            

            <code class="ruby">    when &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="188">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      scope = scope.active</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            

            <code class="ruby">    when &quot;inactive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="190">
            

            

            <code class="ruby">      scope = scope.inactive</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            

            <code class="ruby">    when &quot;expired&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="192">
            

            

            <code class="ruby">      scope = scope.expired</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            

            <code class="ruby">    # Filter by project</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="196">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    scope = scope.by_project(params[:project]) if params[:project].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            

            <code class="ruby">    # Filter by dsl_tag</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="199">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    scope = scope.by_dsl_tag(params[:dsl_tag]) if params[:dsl_tag].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            

            <code class="ruby">    # Filter by currency</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="202">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    scope = scope.by_currency(params[:currency]) if params[:currency].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            

            <code class="ruby">    # Filter by country</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="205">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    scope = scope.by_country(params[:country]) if params[:country].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            

            <code class="ruby">    # Search by name or code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="208">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    if params[:search].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="209">
            

            

            <code class="ruby">      scope = scope.where(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            

            <code class="ruby">        &quot;name LIKE :search OR code LIKE :search&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            

            <code class="ruby">        search: &quot;%#{params[:search]}%&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            

            <code class="ruby">    # Date range filters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="216">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    if params[:start_date].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="217">
            

            

            <code class="ruby">      scope = scope.where(&quot;availability_start_date &gt;= ?&quot;, params[:start_date])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="220">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    if params[:end_date].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="221">
            

            

            <code class="ruby">      scope = scope.where(&quot;availability_end_date &lt;= ?&quot;, params[:end_date])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="224">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    scope.order(created_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="227">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def clean_inappropriate_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            

            <code class="ruby">    #  minimum_deposit  ,    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="229">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">    non_deposit_events = %w[input_coupon manual collection groups_update scheduler]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="231">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">    if non_deposit_events.include?(@bonus.event)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="232">
            

            

            <code class="ruby">      @bonus.minimum_deposit = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="233">
            

            

            <code class="ruby">      @bonus.currency_minimum_deposits = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="237">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_type_specific_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            

            <code class="ruby">    # This method is called after bonus creation/update to handle type-specific attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            

            <code class="ruby">    # Currently handled by reward associations, so this is a no-op</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="83f0980b10577f55e90e78d5632e43711a443fd8">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">  # Only allow modern browsers supporting webp images, web push, badges, import maps, CSS nesting, and CSS :has.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  allow_browser versions: :modern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="005d5b77512b65cea7c12f999849fcfe0d4301c3">
  <div class="header">
    <h3>app/controllers/bonuses_controller.rb</h3>
    <h4>
      <span class="red">
  43.01%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>465</b> relevant lines.
      <span class="green"><b>200</b> lines covered</span> and
      <span class="red"><b>265</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class BonusesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_bonus, only: [ :show, :edit, :update, :destroy, :preview ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">  # GET /bonuses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="6">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">    @bonuses = Bonus.includes(:bonus_rewards, :freespin_rewards, :bonus_buy_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">                             :freechip_rewards, :bonus_code_rewards, :material_prize_rewards, :comp_point_rewards)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">    # Filter by event if specified</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="10">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @bonuses = @bonuses.by_event(params[:type] || params[:event]) if (params[:type] || params[:event]).present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    # Filter by status if specified</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="13">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    case params[:status]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">    when &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @bonuses = @bonuses.active</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">    when &quot;inactive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @bonuses = @bonuses.inactive</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">    when &quot;expired&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @bonuses = @bonuses.expired</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">    # Filter by currency if specified</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="23">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @bonuses = @bonuses.by_currency(params[:currency]) if params[:currency].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">    # Filter by country if specified</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="26">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @bonuses = @bonuses.by_country(params[:country]) if params[:country].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">    # Filter by project if specified</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="29">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @bonuses = @bonuses.by_project(params[:project]) if params[:project].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">    # Filter by dsl_tag if specified</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="32">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @bonuses = @bonuses.by_dsl_tag(params[:dsl_tag]) if params[:dsl_tag].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">    # Search by name or code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="35">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    if params[:search].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="36">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      search_term = &quot;%#{params[:search]}%&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="37">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      @bonuses = @bonuses.where(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">        &quot;LOWER(name) LIKE LOWER(?) OR LOWER(code) LIKE LOWER(?)&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">        search_term, search_term</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="43">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @bonuses = @bonuses.order(id: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">    # Get permanent bonus previews for current project</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="46">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @permanent_bonus_previews = Bonus.permanent_bonus_previews_for_project(params[:project])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby">    # Pagination with 50 bonuses per page</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="49">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    page = (params[:page] || 1).to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="50">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    per_page = 25</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="51">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    offset = (page - 1) * per_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby">    # Get total count for pagination info</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="54">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @total_bonuses = @bonuses.count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="55">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @total_pages = (@total_bonuses.to_f / per_page).ceil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="57">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    @bonuses = @bonuses.limit(per_page).offset(offset)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="59">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="60">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">      format.html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="61">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">      format.json { render json: @bonuses.as_json(except: [ :currency ]) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">  # GET /bonuses/1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="67">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="68">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      format.html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="69">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      format.json { render json: @bonus.as_json(include: bonus_includes, except: [ :currency ]) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby">  # GET /bonuses/new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="75">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @bonus = Bonus.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="76">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @event_type = params[:event] || params[:type] || &quot;deposit&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="77">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @bonus.event = @event_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">  # GET /bonuses/1/edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby">  # POST /bonuses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="85">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="86">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">    @bonus = Bonus.new(bonus_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            

            <code class="ruby">    # Set currency from currencies array if currency is blank</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="89">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">    if @bonus.currency.blank? &amp;&amp; @bonus.currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby">      # Filter out blank currencies and take the first valid one</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            

            

            <code class="ruby">      valid_currencies = @bonus.currencies.reject(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            

            

            <code class="ruby">      @bonus.currency = valid_currencies.first if valid_currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="95">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="96">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">      if @bonus.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby">        # Create bonus rewards if provided (singular or multiple)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="98">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        create_bonus_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="99">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        create_multiple_bonus_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby">        # Create freespin rewards if provided (singular or multiple)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="101">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        create_freespin_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="102">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        create_multiple_freespin_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby">        # Create multiple bonus_buy rewards if provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="104">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        create_multiple_bonus_buy_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            

            <code class="ruby">        # Create multiple comp_point rewards if provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="106">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        create_multiple_comp_point_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby">        # Create multiple bonus_code rewards if provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="108">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        create_multiple_bonus_code_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="109">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        update_type_specific_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="110">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">        format.html { redirect_to @bonus, notice: &quot;Bonus was successfully created.&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="111">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        format.json { render json: @bonus, status: :created, location: @bonus }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="113">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        @event_type = @bonus.event</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby">        # Debug logging for validation errors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="115">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        Rails.logger.debug &quot;Bonus creation failed. Errors: #{@bonus.errors.full_messages}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="116">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        Rails.logger.debug &quot;Bonus attributes: #{@bonus.attributes}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="117">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">        format.html { render :new }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="118">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        format.json { render json: @bonus.errors, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            

            <code class="ruby">  # PATCH/PUT /bonuses/1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="124">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            

            <code class="ruby">    # Debug logging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="126">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    Rails.logger.debug &quot;Update params: #{params.inspect}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="127">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    Rails.logger.debug &quot;Bonus params: #{bonus_params.inspect}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="128">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    Rails.logger.debug &quot;Currency minimum deposits params: #{params[:bonus][:currency_minimum_deposits].inspect}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            

            <code class="ruby">    # Set currency from currencies array if currency is blank</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="131">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    bonus_attributes = bonus_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="132">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    if bonus_attributes[:currency].blank? &amp;&amp; bonus_attributes[:currencies].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            

            <code class="ruby">      # Filter out blank currencies and take the first valid one</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            

            

            <code class="ruby">      valid_currencies = bonus_attributes[:currencies].reject(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            

            

            <code class="ruby">      bonus_attributes[:currency] = valid_currencies.first if valid_currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="138">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="139">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">      if @bonus.update(bonus_attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            

            <code class="ruby">        # Update or create bonus rewards if provided (singular or multiple)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="141">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">        update_bonus_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="142">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">        update_multiple_bonus_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            

            <code class="ruby">        # Update or create freespin rewards if provided (singular or multiple)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="144">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">        update_freespin_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="145">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">        update_multiple_freespin_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            

            <code class="ruby">        # Update or create bonus_buy rewards if provided (singular or multiple)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="147">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">        update_bonus_buy_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="148">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">        update_multiple_bonus_buy_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            

            <code class="ruby">        # Update or create comp_point rewards if provided (singular or multiple)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="150">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">        update_comp_point_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            

            

            <code class="ruby">        update_multiple_comp_point_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            

            <code class="ruby">        # Update or create bonus_code rewards if provided (singular or multiple)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="153">
            

            

            <code class="ruby">        update_bonus_code_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="154">
            

            

            <code class="ruby">        update_multiple_bonus_code_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="155">
            

            

            <code class="ruby">        update_type_specific_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            

            

            <code class="ruby">        format.html { redirect_to @bonus, notice: &quot;Bonus was successfully updated.&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            

            

            <code class="ruby">        format.json { render json: @bonus }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="159">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">        Rails.logger.debug &quot;Bonus update failed. Errors: #{@bonus.errors.full_messages}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="160">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">        format.html { render :edit }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="161">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">        format.json { render json: @bonus.errors, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            

            <code class="ruby">  # DELETE /bonuses/1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="167">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="168">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    @bonus.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="169">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="170">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      format.html { redirect_to bonuses_url, notice: &quot;Bonus was successfully deleted.&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="171">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      format.json { head :no_content }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            

            <code class="ruby">  # GET /bonuses/1/preview</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="178">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def preview</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="179">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    render json: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            

            <code class="ruby">      bonus: @bonus.as_json(include: bonus_includes, except: [ :currency ]),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            

            <code class="ruby">      preview_data: generate_preview_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            

            <code class="ruby">  # GET /bonuses/by_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="186">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def by_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="187">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    event_param = params[:type] || params[:event]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="188">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @bonuses = Bonus.by_event(event_param) if event_param.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="189">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @bonuses ||= Bonus.none</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="191">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    render json: @bonuses.as_json(except: [ :currency ])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            

            <code class="ruby">  # POST /bonuses/bulk_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="195">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bulk_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="196">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    bonus_ids = params[:bonus_ids] || []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="197">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    action = params[:bulk_action]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="199">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    bonuses = Bonus.where(id: bonus_ids)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="201">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    case action</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            

            <code class="ruby">    when &quot;delete&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="203">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      bonuses.destroy_all</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="204">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      message = &quot;Bonuses were successfully deleted.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="206">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      message = &quot;Invalid bulk action.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="209">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    redirect_to bonuses_path, notice: message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="212">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="214">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_bonus</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="215">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">    @bonus = Bonus.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="218">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="219">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    params.require(:bonus).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            

            <code class="ruby">      :name, :code, :event, :status, :minimum_deposit, :wager,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            

            <code class="ruby">      :maximum_winnings, :wagering_strategy, :availability_start_date,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            

            <code class="ruby">      :availability_end_date, :user_group, :tags, :country, :currency,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            

            <code class="ruby">      :project, :dsl_tag, :created_by, :updated_by, :groups, :no_more, :totally_no_more,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            

            <code class="ruby">      :description,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            

            <code class="ruby">      currencies: [], currency_minimum_deposits: {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="229">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="230">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    return {} unless params[:bonus_reward].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="232">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    permitted = params.require(:bonus_reward).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            

            <code class="ruby">      :bonus_type, :amount, :percentage, :wager, :max_win_fixed, :max_win_multiplier,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            

            <code class="ruby">      :available, :code, :min, :groups, :tags, :user_can_have_duplicates, :no_more, :totally_no_more, :wagering_strategy,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            

            <code class="ruby">      # Advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            

            <code class="ruby">      :range, :last_login_country, :profile_country, :current_ip_country, :emails,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            

            <code class="ruby">      :stag, :deposit_payment_systems, :cashout_payment_systems,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            

            <code class="ruby">      :user_can_have_disposable_email, :total_deposits, :deposits_sum, :loss_sum,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            

            <code class="ruby">      :deposits_count, :spend_sum, :category_loss_sum, :wager_sum, :bets_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            

            <code class="ruby">      :affiliates_user, :balance, :cashout, :chargeable_comp_points,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            

            <code class="ruby">      :persistent_comp_points, :date_of_birth, :deposit, :gender, :issued_bonus,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            

            <code class="ruby">      :registered, :social_networks, :hold_min, :hold_max,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            

            <code class="ruby">      currencies: []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            

            <code class="ruby">    # Process max_win logic</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="247">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:max_win_type] == &quot;multiplier&quot; &amp;&amp; permitted[:max_win_multiplier].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="248">
            

            

            <code class="ruby">      permitted[:max_win] = &quot;x#{permitted[:max_win_multiplier]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="249">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    elsif permitted[:max_win_fixed].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="250">
            

            

            <code class="ruby">      permitted[:max_win] = permitted[:max_win_fixed]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            

            <code class="ruby">    # Clean up temporary fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="254">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    permitted.delete(:max_win_fixed)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="255">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    permitted.delete(:max_win_multiplier)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="256">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    permitted.delete(:bonus_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="258">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="261">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create_bonus_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="262">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    reward_params = bonus_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="263">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return if reward_params.empty? || (reward_params[:amount].blank? &amp;&amp; reward_params[:percentage].blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="265">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward = @bonus.bonus_rewards.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            

            <code class="ruby">      reward_type: &quot;bonus&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            

            <code class="ruby">      amount: reward_params[:amount],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            

            <code class="ruby">      percentage: reward_params[:percentage]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            

            <code class="ruby">    # Set all additional parameters through the config field</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="272">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="273">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward_params.except(:amount, :percentage).each do |key, value|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="274">
            

            

            <code class="ruby">      next if value.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="275">
            

            

            <code class="ruby">      config[key.to_s] = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="278">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward.config = config unless config.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="279">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="282">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_bonus_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="283">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    reward_params = bonus_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="284">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    return if reward_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            

            <code class="ruby">    # Find existing bonus reward or create new one</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="287">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward = @bonus.bonus_rewards.find_by(reward_type: &quot;bonus&quot;) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            

            <code class="ruby">             @bonus.bonus_rewards.build(reward_type: &quot;bonus&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            

            <code class="ruby">    # Update amount/percentage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="291">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward.amount = reward_params[:amount] if reward_params[:amount].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="292">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward.percentage = reward_params[:percentage] if reward_params[:percentage].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            

            <code class="ruby">    # Update config</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="295">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    config = reward.config || {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="296">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward_params.except(:amount, :percentage).each do |key, value|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="297">
            

            

            <code class="ruby">      if value.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="298">
            

            

            <code class="ruby">        config.delete(key.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="300">
            

            

            <code class="ruby">        config[key.to_s] = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="304">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward.config = config</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="305">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="308">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def freespin_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="309">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    return {} unless params[:freespin_reward].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="311">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    permitted = params.require(:freespin_reward).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            

            <code class="ruby">      :spins_count, :games, :bet_level, :max_win, :no_more, :totally_no_more, :available, :code,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            

            

            <code class="ruby">      :min, :groups, :tags, :stag, :wagering_strategy,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            

            

            <code class="ruby">      # Advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            

            <code class="ruby">      :auto_activate, :duration, :activation_duration, :email_template, :range,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            

            <code class="ruby">      :last_login_country, :profile_country, :current_ip_country, :emails,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            

            <code class="ruby">      :deposit_payment_systems, :cashout_payment_systems, :user_can_have_duplicates,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            

            <code class="ruby">      :user_can_have_disposable_email, :total_deposits, :deposits_sum, :loss_sum,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            

            <code class="ruby">      :deposits_count, :spend_sum, :category_loss_sum, :wager_sum, :bets_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            

            <code class="ruby">      :affiliates_user, :balance, :chargeable_comp_points, :persistent_comp_points,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            

            <code class="ruby">      :date_of_birth, :deposit, :gender, :issued_bonus, :registered, :social_networks,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            

            <code class="ruby">      :wager_done, :hold_min, :hold_max, :currencies, currencies: []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            

            <code class="ruby">    # Handle array fields properly</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="326">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    permitted[:games] = permitted[:games].split(&quot;,&quot;).map(&amp;:strip) if permitted[:games].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="327">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    permitted[:tags] = permitted[:tags].split(&quot;,&quot;).map(&amp;:strip) if permitted[:tags].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="328">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="329">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="332">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create_freespin_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="333">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    reward_params = freespin_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="334">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return if reward_params.empty? || reward_params[:spins_count].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="336">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward = @bonus.freespin_rewards.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="337">
            

            

            <code class="ruby">      spins_count: reward_params[:spins_count]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="338">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="339">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            

            

            <code class="ruby">    # Set common parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="341">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.games = reward_params[:games] if reward_params[:games].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="342">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.bet_level = reward_params[:bet_level] if reward_params[:bet_level].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="343">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.max_win = reward_params[:max_win] if reward_params[:max_win].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="344">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.no_more = reward_params[:no_more] if reward_params[:no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="345">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.totally_no_more = reward_params[:totally_no_more] if reward_params[:totally_no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="346">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.available = reward_params[:available] if reward_params[:available].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="347">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.code = reward_params[:code] if reward_params[:code].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="348">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.min_deposit = reward_params[:min] if reward_params[:min].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="349">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.groups = reward_params[:groups] if reward_params[:groups].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="350">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.tags = reward_params[:tags] if reward_params[:tags].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="351">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.stag = reward_params[:stag] if reward_params[:stag].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="352">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.wagering_strategy = reward_params[:wagering_strategy] if reward_params[:wagering_strategy].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="353">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.currencies = reward_params[:currencies] if reward_params[:currencies].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="354">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="355">
            

            

            <code class="ruby">    # Set advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="356">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="357">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.advanced_params.each do |param|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="105" data-linenumber="358">
            
              <span class="hits">105</span>
            

            

            <code class="ruby">      config[param] = reward_params[param.to_sym] if reward_params[param.to_sym].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="359">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="360">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="361">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.config = config</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="362">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="363">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="364">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="365">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_freespin_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="366">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    reward_params = freespin_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="367">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    return if reward_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="368">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="369">
            

            

            <code class="ruby">    # Find existing freespin reward or create new one</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="370">
            

            

            <code class="ruby">    reward = @bonus.freespin_rewards.first || @bonus.freespin_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="371">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="372">
            

            

            <code class="ruby">    # Update spins count if provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="373">
            

            

            <code class="ruby">    reward.spins_count = reward_params[:spins_count] if reward_params[:spins_count].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="374">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="375">
            

            

            <code class="ruby">    # Update common parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="376">
            

            

            <code class="ruby">    reward.games = reward_params[:games] if reward_params[:games].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="377">
            

            

            <code class="ruby">    reward.bet_level = reward_params[:bet_level] if reward_params[:bet_level].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="378">
            

            

            <code class="ruby">    reward.max_win = reward_params[:max_win] if reward_params[:max_win].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="379">
            

            

            <code class="ruby">    reward.no_more = reward_params[:no_more] if reward_params[:no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="380">
            

            

            <code class="ruby">    reward.totally_no_more = reward_params[:totally_no_more] if reward_params[:totally_no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="381">
            

            

            <code class="ruby">    reward.available = reward_params[:available] if reward_params[:available].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="382">
            

            

            <code class="ruby">    reward.code = reward_params[:code] if reward_params[:code].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="383">
            

            

            <code class="ruby">    reward.min_deposit = reward_params[:min] if reward_params[:min].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="384">
            

            

            <code class="ruby">    reward.groups = reward_params[:groups] if reward_params[:groups].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="385">
            

            

            <code class="ruby">    reward.tags = reward_params[:tags] if reward_params[:tags].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="386">
            

            

            <code class="ruby">    reward.stag = reward_params[:stag] if reward_params[:stag].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="387">
            

            

            <code class="ruby">    reward.wagering_strategy = reward_params[:wagering_strategy] if reward_params[:wagering_strategy].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="388">
            

            

            <code class="ruby">    reward.currencies = reward_params[:currencies] if reward_params[:currencies].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            

            <code class="ruby">    # Update advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="391">
            

            

            <code class="ruby">    config = reward.config || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="392">
            

            

            <code class="ruby">    reward.advanced_params.each do |param|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="393">
            

            

            <code class="ruby">      if reward_params[param.to_sym].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="394">
            

            

            <code class="ruby">        config[param] = reward_params[param.to_sym]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="395">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="396">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="397">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="398">
            

            

            <code class="ruby">    reward.config = config</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="399">
            

            

            <code class="ruby">    reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="400">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="401">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="402">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def multiple_bonus_rewards_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="403">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return [] unless params[:bonus_rewards].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="404">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="405">
            

            

            <code class="ruby">    params[:bonus_rewards].values.map do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="406">
            

            

            <code class="ruby">      next if reward_params.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="407">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="408">
            

            

            <code class="ruby">      permitted = reward_params.permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="409">
            

            

            <code class="ruby">        :bonus_type, :amount, :percentage, :wager, :max_win_fixed, :max_win_multiplier,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="410">
            

            

            <code class="ruby">        :available, :code, :min, :groups, :tags, :user_can_have_duplicates, :no_more, :totally_no_more, :wagering_strategy,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="411">
            

            

            <code class="ruby">        # Advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="412">
            

            

            <code class="ruby">        :range, :last_login_country, :profile_country, :current_ip_country, :emails,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="413">
            

            

            <code class="ruby">        :stag, :deposit_payment_systems, :cashout_payment_systems,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="414">
            

            

            <code class="ruby">        :user_can_have_disposable_email, :total_deposits, :deposits_sum, :loss_sum,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="415">
            

            

            <code class="ruby">        :deposits_count, :spend_sum, :category_loss_sum, :wager_sum, :bets_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="416">
            

            

            <code class="ruby">        :affiliates_user, :balance, :cashout, :chargeable_comp_points,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="417">
            

            

            <code class="ruby">        :persistent_comp_points, :date_of_birth, :deposit, :gender, :issued_bonus,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="418">
            

            

            <code class="ruby">        :registered, :social_networks, :hold_min, :hold_max,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="419">
            

            

            <code class="ruby">        :currencies, currencies: []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="420">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="421">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="422">
            

            

            <code class="ruby">      # Handle array fields properly</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="423">
            

            

            <code class="ruby">      permitted[:groups] = permitted[:groups].split(&quot;,&quot;).map(&amp;:strip) if permitted[:groups].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="424">
            

            

            <code class="ruby">      permitted[:tags] = permitted[:tags].split(&quot;,&quot;).map(&amp;:strip) if permitted[:tags].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="425">
            

            

            <code class="ruby">      permitted[:currencies] = permitted[:currencies].compact.reject(&amp;:blank?) if permitted[:currencies].is_a?(Array)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="426">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="427">
            

            

            <code class="ruby">      permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="428">
            

            

            <code class="ruby">    end.compact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="429">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="430">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="431">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def multiple_freespin_rewards_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="432">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return [] unless params[:freespin_rewards].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="433">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="434">
            

            

            <code class="ruby">    params[:freespin_rewards].values.map do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="435">
            

            

            <code class="ruby">      next if reward_params.blank? || reward_params[:spins_count].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="436">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="437">
            

            

            <code class="ruby">      permitted = reward_params.permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="438">
            

            

            <code class="ruby">        :spins_count, :games, :bet_level, :max_win, :no_more, :totally_no_more, :available, :code,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="439">
            

            

            <code class="ruby">        :tags, :stag,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="440">
            

            

            <code class="ruby">        # Advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="441">
            

            

            <code class="ruby">        :auto_activate, :duration, :activation_duration, :email_template, :range,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="442">
            

            

            <code class="ruby">        :last_login_country, :profile_country, :current_ip_country, :emails,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="443">
            

            

            <code class="ruby">        :deposit_payment_systems, :cashout_payment_systems, :user_can_have_duplicates,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="444">
            

            

            <code class="ruby">        :user_can_have_disposable_email, :total_deposits, :deposits_sum, :loss_sum,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="445">
            

            

            <code class="ruby">        :deposits_count, :spend_sum, :category_loss_sum, :wager_sum, :bets_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="446">
            

            

            <code class="ruby">        :affiliates_user, :balance, :chargeable_comp_points, :persistent_comp_points,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="447">
            

            

            <code class="ruby">        :date_of_birth, :deposit, :gender, :issued_bonus, :registered, :social_networks,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="448">
            

            

            <code class="ruby">        :wager_done, :hold_min, :hold_max,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="449">
            

            

            <code class="ruby">        # Currency bet levels</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="450">
            

            

            <code class="ruby">        currency_bet_levels: {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="451">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="452">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="453">
            

            

            <code class="ruby">      # Handle array fields properly</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="454">
            

            

            <code class="ruby">      permitted[:games] = permitted[:games].split(&quot;,&quot;).map(&amp;:strip) if permitted[:games].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="455">
            

            

            <code class="ruby">      permitted[:groups] = permitted[:groups].split(&quot;,&quot;).map(&amp;:strip) if permitted[:groups].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="456">
            

            

            <code class="ruby">      permitted[:tags] = permitted[:tags].split(&quot;,&quot;).map(&amp;:strip) if permitted[:tags].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="457">
            

            

            <code class="ruby">      permitted[:currencies] = permitted[:currencies].split(&quot;,&quot;).map(&amp;:strip) if permitted[:currencies].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="458">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="459">
            

            

            <code class="ruby">      permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="460">
            

            

            <code class="ruby">    end.compact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="461">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="462">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="463">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create_multiple_bonus_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="464">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    rewards_params = multiple_bonus_rewards_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="465">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return if rewards_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="466">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="467">
            

            

            <code class="ruby">    rewards_params.each do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="468">
            

            

            <code class="ruby">      next if reward_params[:amount].blank? &amp;&amp; reward_params[:percentage].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="469">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="470">
            

            

            <code class="ruby">      reward = @bonus.bonus_rewards.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="471">
            

            

            <code class="ruby">        reward_type: &quot;bonus&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="472">
            

            

            <code class="ruby">        amount: reward_params[:amount],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="473">
            

            

            <code class="ruby">        percentage: reward_params[:percentage]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="474">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="475">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="476">
            

            

            <code class="ruby">      # Set all additional parameters through the config field</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="477">
            

            

            <code class="ruby">      config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="478">
            

            

            <code class="ruby">      reward_params.except(:amount, :percentage).each do |key, value|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="479">
            

            

            <code class="ruby">        next if value.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="480">
            

            

            <code class="ruby">        config[key.to_s] = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="481">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="482">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="483">
            

            

            <code class="ruby">      # Add common parameters from bonus</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="484">
            

            

            <code class="ruby">      config[&quot;currencies&quot;] = @bonus.currencies if @bonus.currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="485">
            

            

            <code class="ruby">      config[&quot;groups&quot;] = @bonus.groups if @bonus.groups.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="486">
            

            

            <code class="ruby">      config[&quot;min&quot;] = @bonus.minimum_deposit if @bonus.minimum_deposit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="487">
            

            

            <code class="ruby">      config[&quot;wagering_strategy&quot;] = @bonus.wagering_strategy if @bonus.wagering_strategy.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="488">
            

            

            <code class="ruby">      config[&quot;no_more&quot;] = @bonus.no_more if @bonus.no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="489">
            

            

            <code class="ruby">      config[&quot;totally_no_more&quot;] = @bonus.totally_no_more if @bonus.totally_no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="490">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="491">
            

            

            <code class="ruby">      reward.config = config unless config.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="492">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="493">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="494">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="495">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="496">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create_multiple_freespin_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="497">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    rewards_params = multiple_freespin_rewards_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="498">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return if rewards_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="499">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="500">
            

            

            <code class="ruby">    rewards_params.each do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="501">
            

            

            <code class="ruby">      reward = @bonus.freespin_rewards.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="502">
            

            

            <code class="ruby">        spins_count: reward_params[:spins_count]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="503">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="504">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="505">
            

            

            <code class="ruby">      # Set common parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="506">
            

            

            <code class="ruby">      reward.games = reward_params[:games] if reward_params[:games].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="507">
            

            

            <code class="ruby">      reward.bet_level = reward_params[:bet_level] if reward_params[:bet_level].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="508">
            

            

            <code class="ruby">      reward.max_win = reward_params[:max_win] if reward_params[:max_win].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="509">
            

            

            <code class="ruby">      reward.no_more = reward_params[:no_more] if reward_params[:no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="510">
            

            

            <code class="ruby">      reward.totally_no_more = reward_params[:totally_no_more] if reward_params[:totally_no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="511">
            

            

            <code class="ruby">      reward.available = reward_params[:available] if reward_params[:available].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="512">
            

            

            <code class="ruby">      reward.code = reward_params[:code] if reward_params[:code].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="513">
            

            

            <code class="ruby">      reward.tags = reward_params[:tags] if reward_params[:tags].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="514">
            

            

            <code class="ruby">      reward.stag = reward_params[:stag] if reward_params[:stag].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="515">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="516">
            

            

            <code class="ruby">      # Use common parameters from bonus</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="517">
            

            

            <code class="ruby">      reward.min_deposit = @bonus.minimum_deposit if @bonus.minimum_deposit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="518">
            

            

            <code class="ruby">      reward.groups = @bonus.groups if @bonus.groups.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="519">
            

            

            <code class="ruby">      reward.wagering_strategy = @bonus.wagering_strategy if @bonus.wagering_strategy.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="520">
            

            

            <code class="ruby">      reward.currencies = @bonus.currencies if @bonus.currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="521">
            

            

            <code class="ruby">      reward.no_more = @bonus.no_more if @bonus.no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="522">
            

            

            <code class="ruby">      reward.totally_no_more = @bonus.totally_no_more if @bonus.totally_no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="523">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="524">
            

            

            <code class="ruby">      # Set currency bet levels</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="525">
            

            

            <code class="ruby">      if reward_params[:currency_bet_levels].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="526">
            

            

            <code class="ruby">        reward.currency_bet_levels = reward_params[:currency_bet_levels]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="527">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="528">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="529">
            

            

            <code class="ruby">      # Set advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="530">
            

            

            <code class="ruby">      config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="531">
            

            

            <code class="ruby">      reward.advanced_params.each do |param|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="532">
            

            

            <code class="ruby">        config[param] = reward_params[param.to_sym] if reward_params[param.to_sym].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="533">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="534">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="535">
            

            

            <code class="ruby">      reward.config = config</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="536">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="537">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="538">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="539">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="540">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_multiple_bonus_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="541">
            

            

            <code class="ruby">    # For updates, we need to handle existing rewards and new ones</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="542">
            

            

            <code class="ruby">    # This is a complex topic that would need careful design</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="543">
            

            

            <code class="ruby">    # For now, fall back to legacy method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="544">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    update_bonus_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="545">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="546">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="547">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_multiple_freespin_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="548">
            

            

            <code class="ruby">    # For updates, we need to handle existing rewards and new ones</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="549">
            

            

            <code class="ruby">    # This is a complex topic that would need careful design</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="550">
            

            

            <code class="ruby">    # For now, fall back to legacy method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="551">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    update_freespin_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="552">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="553">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="554">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_buy_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="555">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    return {} unless params[:bonus_buy_reward].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="556">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="557">
            

            

            <code class="ruby">    permitted = params.require(:bonus_buy_reward).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="558">
            

            

            <code class="ruby">      :buy_amount, :multiplier, :games, :bet_level, :max_win, :no_more, :totally_no_more, :available, :code,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="559">
            

            

            <code class="ruby">      :min, :groups, :tags, :stag, :wagering_strategy,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="560">
            

            

            <code class="ruby">      # Advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="561">
            

            

            <code class="ruby">      :auto_activate, :duration, :activation_duration, :email_template, :range,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="562">
            

            

            <code class="ruby">      :last_login_country, :profile_country, :current_ip_country, :emails,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="563">
            

            

            <code class="ruby">      :deposit_payment_systems, :cashout_payment_systems, :user_can_have_duplicates,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="564">
            

            

            <code class="ruby">      :user_can_have_disposable_email, :total_deposits, :deposits_sum, :loss_sum,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="565">
            

            

            <code class="ruby">      :deposits_count, :spend_sum, :category_loss_sum, :wager_sum, :bets_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="566">
            

            

            <code class="ruby">      :affiliates_user, :balance, :chargeable_comp_points, :persistent_comp_points,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="567">
            

            

            <code class="ruby">      :date_of_birth, :deposit, :gender, :issued_bonus, :registered, :social_networks,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="568">
            

            

            <code class="ruby">      :wager_done, :hold_min, :hold_max, :currencies, currencies: [],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="569">
            

            

            <code class="ruby">      # Currency bet levels</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="570">
            

            

            <code class="ruby">      currency_bet_levels: {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="571">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="572">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="573">
            

            

            <code class="ruby">    # Handle array fields properly</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="574">
            

            

            <code class="ruby">    permitted[:games] = permitted[:games].split(&quot;,&quot;).map(&amp;:strip) if permitted[:games].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="575">
            

            

            <code class="ruby">    permitted[:tags] = permitted[:tags].split(&quot;,&quot;).map(&amp;:strip) if permitted[:tags].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="576">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="577">
            

            

            <code class="ruby">    permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="578">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="579">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="580">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def multiple_bonus_buy_rewards_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="581">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return [] unless params[:bonus_buy_rewards].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="582">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="583">
            

            

            <code class="ruby">    params[:bonus_buy_rewards].values.map do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="584">
            

            

            <code class="ruby">      next if reward_params.blank? || reward_params[:buy_amount].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="585">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="586">
            

            

            <code class="ruby">      permitted = reward_params.permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="587">
            

            

            <code class="ruby">        :buy_amount, :multiplier, :games, :bet_level, :max_win, :no_more, :totally_no_more, :available, :code,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="588">
            

            

            <code class="ruby">        :min, :groups, :tags, :stag, :wagering_strategy,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="589">
            

            

            <code class="ruby">        # Advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="590">
            

            

            <code class="ruby">        :auto_activate, :duration, :activation_duration, :email_template, :range,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="591">
            

            

            <code class="ruby">        :last_login_country, :profile_country, :current_ip_country, :emails,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="592">
            

            

            <code class="ruby">        :deposit_payment_systems, :cashout_payment_systems, :user_can_have_duplicates,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="593">
            

            

            <code class="ruby">        :user_can_have_disposable_email, :total_deposits, :deposits_sum, :loss_sum,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="594">
            

            

            <code class="ruby">        :deposits_count, :spend_sum, :category_loss_sum, :wager_sum, :bets_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="595">
            

            

            <code class="ruby">        :affiliates_user, :balance, :chargeable_comp_points, :persistent_comp_points,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="596">
            

            

            <code class="ruby">        :date_of_birth, :deposit, :gender, :issued_bonus, :registered, :social_networks,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="597">
            

            

            <code class="ruby">        :wager_done, :hold_min, :hold_max, :currencies, currencies: [],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="598">
            

            

            <code class="ruby">        # Currency bet levels</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="599">
            

            

            <code class="ruby">        currency_bet_levels: {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="600">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="601">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="602">
            

            

            <code class="ruby">      # Handle array fields properly</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="603">
            

            

            <code class="ruby">      permitted[:games] = permitted[:games].split(&quot;,&quot;).map(&amp;:strip) if permitted[:games].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="604">
            

            

            <code class="ruby">      permitted[:groups] = permitted[:groups].split(&quot;,&quot;).map(&amp;:strip) if permitted[:groups].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="605">
            

            

            <code class="ruby">      permitted[:tags] = permitted[:tags].split(&quot;,&quot;).map(&amp;:strip) if permitted[:tags].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="606">
            

            

            <code class="ruby">      permitted[:currencies] = permitted[:currencies].split(&quot;,&quot;).map(&amp;:strip) if permitted[:currencies].is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="607">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="608">
            

            

            <code class="ruby">      permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="609">
            

            

            <code class="ruby">    end.compact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="610">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="611">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="612">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create_multiple_bonus_buy_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="613">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    rewards_params = multiple_bonus_buy_rewards_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="614">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return if rewards_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="615">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="616">
            

            

            <code class="ruby">    rewards_params.each do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="617">
            

            

            <code class="ruby">      reward = @bonus.bonus_buy_rewards.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="618">
            

            

            <code class="ruby">        buy_amount: reward_params[:buy_amount],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="619">
            

            

            <code class="ruby">        multiplier: reward_params[:multiplier]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="620">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="621">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="622">
            

            

            <code class="ruby">      # Set common parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="623">
            

            

            <code class="ruby">      reward.games = reward_params[:games] if reward_params[:games].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="624">
            

            

            <code class="ruby">      reward.bet_level = reward_params[:bet_level] if reward_params[:bet_level].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="625">
            

            

            <code class="ruby">      reward.max_win = reward_params[:max_win] if reward_params[:max_win].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="626">
            

            

            <code class="ruby">      reward.no_more = reward_params[:no_more] if reward_params[:no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="627">
            

            

            <code class="ruby">      reward.totally_no_more = reward_params[:totally_no_more] if reward_params[:totally_no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="628">
            

            

            <code class="ruby">      reward.available = reward_params[:available] if reward_params[:available].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="629">
            

            

            <code class="ruby">      reward.code = reward_params[:code] if reward_params[:code].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="630">
            

            

            <code class="ruby">      reward.tags = reward_params[:tags] if reward_params[:tags].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="631">
            

            

            <code class="ruby">      reward.stag = reward_params[:stag] if reward_params[:stag].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="632">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="633">
            

            

            <code class="ruby">      # Use common parameters from bonus</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="634">
            

            

            <code class="ruby">      reward.min_deposit = @bonus.minimum_deposit if @bonus.minimum_deposit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="635">
            

            

            <code class="ruby">      reward.groups = @bonus.groups if @bonus.groups.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="636">
            

            

            <code class="ruby">      reward.wagering_strategy = @bonus.wagering_strategy if @bonus.wagering_strategy.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="637">
            

            

            <code class="ruby">      reward.currencies = @bonus.currencies if @bonus.currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="638">
            

            

            <code class="ruby">      reward.no_more = @bonus.no_more if @bonus.no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="639">
            

            

            <code class="ruby">      reward.totally_no_more = @bonus.totally_no_more if @bonus.totally_no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="640">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="641">
            

            

            <code class="ruby">      # Set currency bet levels</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="642">
            

            

            <code class="ruby">      if reward_params[:currency_bet_levels].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="643">
            

            

            <code class="ruby">        reward.currency_bet_levels = reward_params[:currency_bet_levels]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="644">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="645">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="646">
            

            

            <code class="ruby">      # Set advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="647">
            

            

            <code class="ruby">      config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="648">
            

            

            <code class="ruby">      reward.advanced_params.each do |param|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="649">
            

            

            <code class="ruby">        config[param] = reward_params[param.to_sym] if reward_params[param.to_sym].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="650">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="651">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="652">
            

            

            <code class="ruby">      reward.config = config</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="653">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="654">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="655">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="656">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="657">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_multiple_bonus_buy_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="658">
            

            

            <code class="ruby">    # For updates, we need to handle existing rewards and new ones</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="659">
            

            

            <code class="ruby">    # This is a complex topic that would need careful design</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="660">
            

            

            <code class="ruby">    # For now, fall back to legacy method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="661">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    update_bonus_buy_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="662">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="663">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="664">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create_bonus_buy_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="665">
            

            

            <code class="ruby">    reward_params = bonus_buy_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="666">
            

            

            <code class="ruby">    return if reward_params.empty? || reward_params[:buy_amount].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="667">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="668">
            

            

            <code class="ruby">    reward = @bonus.bonus_buy_rewards.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="669">
            

            

            <code class="ruby">      buy_amount: reward_params[:buy_amount],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="670">
            

            

            <code class="ruby">      multiplier: reward_params[:multiplier]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="671">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="672">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="673">
            

            

            <code class="ruby">    # Set common parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="674">
            

            

            <code class="ruby">    reward.games = reward_params[:games] if reward_params[:games].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="675">
            

            

            <code class="ruby">    reward.bet_level = reward_params[:bet_level] if reward_params[:bet_level].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="676">
            

            

            <code class="ruby">    reward.max_win = reward_params[:max_win] if reward_params[:max_win].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="677">
            

            

            <code class="ruby">    reward.no_more = reward_params[:no_more] if reward_params[:no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="678">
            

            

            <code class="ruby">    reward.totally_no_more = reward_params[:totally_no_more] if reward_params[:totally_no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="679">
            

            

            <code class="ruby">    reward.available = reward_params[:available] if reward_params[:available].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="680">
            

            

            <code class="ruby">    reward.code = reward_params[:code] if reward_params[:code].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="681">
            

            

            <code class="ruby">    reward.min_deposit = reward_params[:min] if reward_params[:min].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="682">
            

            

            <code class="ruby">    reward.groups = reward_params[:groups] if reward_params[:groups].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="683">
            

            

            <code class="ruby">    reward.tags = reward_params[:tags] if reward_params[:tags].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="684">
            

            

            <code class="ruby">    reward.stag = reward_params[:stag] if reward_params[:stag].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="685">
            

            

            <code class="ruby">    reward.wagering_strategy = reward_params[:wagering_strategy] if reward_params[:wagering_strategy].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="686">
            

            

            <code class="ruby">    reward.currencies = reward_params[:currencies] if reward_params[:currencies].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="687">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="688">
            

            

            <code class="ruby">    # Set currency bet levels</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="689">
            

            

            <code class="ruby">    if reward_params[:currency_bet_levels].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="690">
            

            

            <code class="ruby">      reward.currency_bet_levels = reward_params[:currency_bet_levels]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="691">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="692">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="693">
            

            

            <code class="ruby">    # Set advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="694">
            

            

            <code class="ruby">    config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="695">
            

            

            <code class="ruby">    reward.advanced_params.each do |param|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="696">
            

            

            <code class="ruby">      config[param] = reward_params[param.to_sym] if reward_params[param.to_sym].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="697">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="698">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="699">
            

            

            <code class="ruby">    reward.config = config</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="700">
            

            

            <code class="ruby">    reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="701">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="702">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="703">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_bonus_buy_reward_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="704">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    reward_params = bonus_buy_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="705">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    return if reward_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="706">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="707">
            

            

            <code class="ruby">    # Find existing bonus_buy reward or create new one</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="708">
            

            

            <code class="ruby">    reward = @bonus.bonus_buy_rewards.first || @bonus.bonus_buy_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="709">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="710">
            

            

            <code class="ruby">    # Update buy amount and multiplier if provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="711">
            

            

            <code class="ruby">    reward.buy_amount = reward_params[:buy_amount] if reward_params[:buy_amount].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="712">
            

            

            <code class="ruby">    reward.multiplier = reward_params[:multiplier] if reward_params[:multiplier].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="713">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="714">
            

            

            <code class="ruby">    # Update common parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="715">
            

            

            <code class="ruby">    reward.games = reward_params[:games] if reward_params[:games].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="716">
            

            

            <code class="ruby">    reward.bet_level = reward_params[:bet_level] if reward_params[:bet_level].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="717">
            

            

            <code class="ruby">    reward.max_win = reward_params[:max_win] if reward_params[:max_win].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="718">
            

            

            <code class="ruby">    reward.no_more = reward_params[:no_more] if reward_params[:no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="719">
            

            

            <code class="ruby">    reward.totally_no_more = reward_params[:totally_no_more] if reward_params[:totally_no_more].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="720">
            

            

            <code class="ruby">    reward.available = reward_params[:available] if reward_params[:available].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="721">
            

            

            <code class="ruby">    reward.code = reward_params[:code] if reward_params[:code].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="722">
            

            

            <code class="ruby">    reward.min_deposit = reward_params[:min] if reward_params[:min].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="723">
            

            

            <code class="ruby">    reward.groups = reward_params[:groups] if reward_params[:groups].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="724">
            

            

            <code class="ruby">    reward.tags = reward_params[:tags] if reward_params[:tags].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="725">
            

            

            <code class="ruby">    reward.stag = reward_params[:stag] if reward_params[:stag].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="726">
            

            

            <code class="ruby">    reward.wagering_strategy = reward_params[:wagering_strategy] if reward_params[:wagering_strategy].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="727">
            

            

            <code class="ruby">    reward.currencies = reward_params[:currencies] if reward_params[:currencies].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="728">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="729">
            

            

            <code class="ruby">    # Update currency bet levels</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="730">
            

            

            <code class="ruby">    if reward_params[:currency_bet_levels].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="731">
            

            

            <code class="ruby">      reward.currency_bet_levels = reward_params[:currency_bet_levels]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="732">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="733">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="734">
            

            

            <code class="ruby">    # Update advanced parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="735">
            

            

            <code class="ruby">    config = reward.config || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="736">
            

            

            <code class="ruby">    reward.advanced_params.each do |param|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="737">
            

            

            <code class="ruby">      if reward_params[param.to_sym].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="738">
            

            

            <code class="ruby">        config[param] = reward_params[param.to_sym]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="739">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="740">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="741">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="742">
            

            

            <code class="ruby">    reward.config = config</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="743">
            

            

            <code class="ruby">    reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="744">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="745">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="746">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_includes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="747">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="748">
            

            

            <code class="ruby">      :bonus_rewards, :freespin_rewards, :bonus_buy_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="749">
            

            

            <code class="ruby">      :freechip_rewards, :bonus_code_rewards, :material_prize_rewards, :comp_point_rewards</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="750">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="751">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="752">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="753">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def generate_preview_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="754">
            

            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="755">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      event: @bonus.event,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="756">
            

            

            <code class="ruby">      rewards_count: @bonus.all_rewards.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="757">
            

            

            <code class="ruby">      reward_types: @bonus.reward_types,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="758">
            

            

            <code class="ruby">      has_rewards: @bonus.has_rewards?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="759">
            

            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="760">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="761">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="762">
            

            

            <code class="ruby">  # Comp Point Rewards Parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="763">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def comp_point_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="764">
            

            

            <code class="ruby">    return {} unless params[:comp_point_reward].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="765">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="766">
            

            

            <code class="ruby">    permitted = params.require(:comp_point_reward).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="767">
            

            

            <code class="ruby">      :issue_chargeable_award, :issue_persistent_award, :title, :config_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="768">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="769">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="770">
            

            

            <code class="ruby">    permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="771">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="772">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="773">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def multiple_comp_point_rewards_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="774">
            

            

            <code class="ruby">    return [] unless params[:comp_point_rewards].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="775">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="776">
            

            

            <code class="ruby">    params[:comp_point_rewards].values.map do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="777">
            

            

            <code class="ruby">      next if reward_params.blank? || (reward_params[:issue_chargeable_award].blank? &amp;&amp; reward_params[:issue_persistent_award].blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="778">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="779">
            

            

            <code class="ruby">      permitted = reward_params.permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="780">
            

            

            <code class="ruby">        :issue_chargeable_award, :issue_persistent_award, :title, :config_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="781">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="782">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="783">
            

            

            <code class="ruby">      permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="784">
            

            

            <code class="ruby">    end.compact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="785">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="786">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="787">
            

            

            <code class="ruby">  # Bonus Code Rewards Parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="788">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_code_reward_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="789">
            

            

            <code class="ruby">    return {} unless params[:bonus_code_reward].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="790">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="791">
            

            

            <code class="ruby">    permitted = params.require(:bonus_code_reward).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="792">
            

            

            <code class="ruby">      :set_bonus_code, :title, :config_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="793">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="794">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="795">
            

            

            <code class="ruby">    permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="796">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="797">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="798">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def multiple_bonus_code_rewards_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="799">
            

            

            <code class="ruby">    return [] unless params[:bonus_code_rewards].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="800">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="801">
            

            

            <code class="ruby">    params[:bonus_code_rewards].values.map do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="802">
            

            

            <code class="ruby">      next if reward_params.blank? || reward_params[:set_bonus_code].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="803">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="804">
            

            

            <code class="ruby">      permitted = reward_params.permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="805">
            

            

            <code class="ruby">        :set_bonus_code, :title, :config_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="806">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="807">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="808">
            

            

            <code class="ruby">      permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="809">
            

            

            <code class="ruby">    end.compact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="810">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="811">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="812">
            

            

            <code class="ruby">  # Create multiple comp_point rewards if provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="813">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create_multiple_comp_point_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="814">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return unless params[:comp_point_rewards].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="815">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="816">
            

            

            <code class="ruby">    multiple_comp_point_rewards_params.each do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="817">
            

            

            <code class="ruby">      next if reward_params.values.all?(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="818">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="819">
            

            

            <code class="ruby">      reward = @bonus.comp_point_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="820">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="821">
            

            

            <code class="ruby">      # Set main attributes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="822">
            

            

            <code class="ruby">      reward.issue_chargeable_award = reward_params[:issue_chargeable_award]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="823">
            

            

            <code class="ruby">      reward.issue_persistent_award = reward_params[:issue_persistent_award]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="824">
            

            

            <code class="ruby">      reward.title = reward_params[:title]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="825">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="826">
            

            

            <code class="ruby">      # Handle config_json if provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="827">
            

            

            <code class="ruby">      if reward_params[:config_json].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="828">
            

            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="829">
            

            

            <code class="ruby">          config = JSON.parse(reward_params[:config_json])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="830">
            

            

            <code class="ruby">        rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="831">
            

            

            <code class="ruby">          config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="832">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="833">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="834">
            

            

            <code class="ruby">        config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="835">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="836">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="837">
            

            

            <code class="ruby">      # Add common parameters from bonus</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="838">
            

            

            <code class="ruby">      config[&quot;currencies&quot;] = @bonus.currencies if @bonus.currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="839">
            

            

            <code class="ruby">      config[&quot;groups&quot;] = @bonus.groups if @bonus.groups.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="840">
            

            

            <code class="ruby">      config[&quot;min&quot;] = @bonus.minimum_deposit if @bonus.minimum_deposit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="841">
            

            

            <code class="ruby">      config[&quot;wagering_strategy&quot;] = @bonus.wagering_strategy if @bonus.wagering_strategy.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="842">
            

            

            <code class="ruby">      config[&quot;no_more&quot;] = @bonus.no_more if @bonus.no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="843">
            

            

            <code class="ruby">      config[&quot;totally_no_more&quot;] = @bonus.totally_no_more if @bonus.totally_no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="844">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="845">
            

            

            <code class="ruby">      reward.config = config unless config.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="846">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="847">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="848">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="849">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="850">
            

            

            <code class="ruby">  # Update multiple comp_point rewards if provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="851">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_multiple_comp_point_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="852">
            

            

            <code class="ruby">    return unless params[:comp_point_rewards].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="853">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="854">
            

            

            <code class="ruby">    # Remove existing comp_point rewards to replace them</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="855">
            

            

            <code class="ruby">    @bonus.comp_point_rewards.destroy_all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="856">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="857">
            

            

            <code class="ruby">    multiple_comp_point_rewards_params.each do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="858">
            

            

            <code class="ruby">      next if reward_params.values.all?(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="859">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="860">
            

            

            <code class="ruby">      reward = @bonus.comp_point_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="861">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="862">
            

            

            <code class="ruby">      # Set main attributes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="863">
            

            

            <code class="ruby">      reward.issue_chargeable_award = reward_params[:issue_chargeable_award]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="864">
            

            

            <code class="ruby">      reward.issue_persistent_award = reward_params[:issue_persistent_award]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="865">
            

            

            <code class="ruby">      reward.title = reward_params[:title]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="866">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="867">
            

            

            <code class="ruby">      # Handle config_json if provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="868">
            

            

            <code class="ruby">      if reward_params[:config_json].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="869">
            

            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="870">
            

            

            <code class="ruby">          config = JSON.parse(reward_params[:config_json])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="871">
            

            

            <code class="ruby">        rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="872">
            

            

            <code class="ruby">          config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="873">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="874">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="875">
            

            

            <code class="ruby">        config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="876">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="877">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="878">
            

            

            <code class="ruby">      # Add common parameters from bonus</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="879">
            

            

            <code class="ruby">      config[&quot;currencies&quot;] = @bonus.currencies if @bonus.currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="880">
            

            

            <code class="ruby">      config[&quot;groups&quot;] = @bonus.groups if @bonus.groups.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="881">
            

            

            <code class="ruby">      config[&quot;min&quot;] = @bonus.minimum_deposit if @bonus.minimum_deposit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="882">
            

            

            <code class="ruby">      config[&quot;wagering_strategy&quot;] = @bonus.wagering_strategy if @bonus.wagering_strategy.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="883">
            

            

            <code class="ruby">      config[&quot;no_more&quot;] = @bonus.no_more if @bonus.no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="884">
            

            

            <code class="ruby">      config[&quot;totally_no_more&quot;] = @bonus.totally_no_more if @bonus.totally_no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="885">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="886">
            

            

            <code class="ruby">      reward.config = config unless config.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="887">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="888">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="889">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="890">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="891">
            

            

            <code class="ruby">  # Create multiple bonus_code rewards if provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="892">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create_multiple_bonus_code_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="893">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return unless params[:bonus_code_rewards].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="894">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="895">
            

            

            <code class="ruby">    multiple_bonus_code_rewards_params.each do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="896">
            

            

            <code class="ruby">      next if reward_params.values.all?(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="897">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="898">
            

            

            <code class="ruby">      reward = @bonus.bonus_code_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="899">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="900">
            

            

            <code class="ruby">      # Set main attributes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="901">
            

            

            <code class="ruby">      reward.set_bonus_code = reward_params[:set_bonus_code]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="902">
            

            

            <code class="ruby">      reward.title = reward_params[:title]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="903">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="904">
            

            

            <code class="ruby">      # Handle config_json if provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="905">
            

            

            <code class="ruby">      if reward_params[:config_json].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="906">
            

            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="907">
            

            

            <code class="ruby">          config = JSON.parse(reward_params[:config_json])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="908">
            

            

            <code class="ruby">        rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="909">
            

            

            <code class="ruby">          config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="910">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="911">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="912">
            

            

            <code class="ruby">        config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="913">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="914">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="915">
            

            

            <code class="ruby">      # Add common parameters from bonus</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="916">
            

            

            <code class="ruby">      config[&quot;currencies&quot;] = @bonus.currencies if @bonus.currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="917">
            

            

            <code class="ruby">      config[&quot;groups&quot;] = @bonus.groups if @bonus.groups.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="918">
            

            

            <code class="ruby">      config[&quot;min&quot;] = @bonus.minimum_deposit if @bonus.minimum_deposit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="919">
            

            

            <code class="ruby">      config[&quot;wagering_strategy&quot;] = @bonus.wagering_strategy if @bonus.wagering_strategy.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="920">
            

            

            <code class="ruby">      config[&quot;no_more&quot;] = @bonus.no_more if @bonus.no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="921">
            

            

            <code class="ruby">      config[&quot;totally_no_more&quot;] = @bonus.totally_no_more if @bonus.totally_no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="922">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="923">
            

            

            <code class="ruby">      reward.config = config unless config.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="924">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="925">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="926">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="927">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="928">
            

            

            <code class="ruby">  # Update multiple bonus_code rewards if provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="929">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_multiple_bonus_code_rewards_if_provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="930">
            

            

            <code class="ruby">    return unless params[:bonus_code_rewards].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="931">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="932">
            

            

            <code class="ruby">    # Remove existing bonus_code rewards to replace them</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="933">
            

            

            <code class="ruby">    @bonus.bonus_code_rewards.destroy_all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="934">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="935">
            

            

            <code class="ruby">    multiple_bonus_code_rewards_params.each do |reward_params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="936">
            

            

            <code class="ruby">      next if reward_params.values.all?(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="937">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="938">
            

            

            <code class="ruby">      reward = @bonus.bonus_code_rewards.build</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="939">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="940">
            

            

            <code class="ruby">      # Set main attributes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="941">
            

            

            <code class="ruby">      reward.set_bonus_code = reward_params[:set_bonus_code]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="942">
            

            

            <code class="ruby">      reward.title = reward_params[:title]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="943">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="944">
            

            

            <code class="ruby">      # Handle config_json if provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="945">
            

            

            <code class="ruby">      if reward_params[:config_json].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="946">
            

            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="947">
            

            

            <code class="ruby">          config = JSON.parse(reward_params[:config_json])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="948">
            

            

            <code class="ruby">        rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="949">
            

            

            <code class="ruby">          config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="950">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="951">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="952">
            

            

            <code class="ruby">        config = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="953">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="954">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="955">
            

            

            <code class="ruby">      # Add common parameters from bonus</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="956">
            

            

            <code class="ruby">      config[&quot;currencies&quot;] = @bonus.currencies if @bonus.currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="957">
            

            

            <code class="ruby">      config[&quot;groups&quot;] = @bonus.groups if @bonus.groups.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="958">
            

            

            <code class="ruby">      config[&quot;min&quot;] = @bonus.minimum_deposit if @bonus.minimum_deposit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="959">
            

            

            <code class="ruby">      config[&quot;wagering_strategy&quot;] = @bonus.wagering_strategy if @bonus.wagering_strategy.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="960">
            

            

            <code class="ruby">      config[&quot;no_more&quot;] = @bonus.no_more if @bonus.no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="961">
            

            

            <code class="ruby">      config[&quot;totally_no_more&quot;] = @bonus.totally_no_more if @bonus.totally_no_more.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="962">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="963">
            

            

            <code class="ruby">      reward.config = config unless config.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="964">
            

            

            <code class="ruby">      reward.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="965">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="966">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="967">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="968">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_type_specific_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="969">
            

            

            <code class="ruby">    # This method is called after bonus creation/update to handle type-specific attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="970">
            

            

            <code class="ruby">    # Currently handled by reward associations, so this is a no-op</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="971">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="972">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c24910a7541c46d497a3f31df3c87eb4bf04173f">
  <div class="header">
    <h3>app/controllers/heatmap_controller.rb</h3>
    <h4>
      <span class="green">
  90.7%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>43</b> relevant lines.
      <span class="green"><b>39</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class HeatmapController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">    #   </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="4">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    @year = parse_year_param(heatmap_params[:year])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="5">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    @month = parse_month_param(heatmap_params[:month])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="6">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    @bonus_event = parse_bonus_event_param(heatmap_params[:bonus_event])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">    #         </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="10">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">      @start_date = Date.new(@year, @month, 1)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="11">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">      @end_date = @start_date.end_of_month</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    rescue Date::Error</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">      # Fallback to current date if invalid parameters</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            

            <code class="ruby">      @year = Date.current.year</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            

            <code class="ruby">      @month = Date.current.month</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            

            <code class="ruby">      @start_date = Date.new(@year, @month, 1)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            

            <code class="ruby">      @end_date = @start_date.end_of_month</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">    #       </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="21">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    @heatmap_data = generate_heatmap_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">    #      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="24">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    @bonus_events = Bonus.distinct.pluck(:event).compact.sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">    #   </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="27">
            
              <span class="hits">60</span>
            

            

            <code class="ruby">    @prev_month = @start_date.prev_month</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="28">
            
              <span class="hits">60</span>
            

            

            <code class="ruby">    @next_month = @start_date.next_month</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def heatmap_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="183" data-linenumber="34">
            
              <span class="hits">183</span>
            

            

            <code class="ruby">    params.permit(:year, :month, :bonus_event)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def parse_year_param(year_param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="38">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    return Date.current.year if year_param.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="40">
            
              <span class="hits">26</span>
            

            

            <code class="ruby">    year = year_param.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">    # Validate year is reasonable (1900-3000)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="42">
            
              <span class="hits">26</span>
            

            

            <code class="ruby">    year &gt; 1900 &amp;&amp; year &lt; 3000 ? year : Date.current.year</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def parse_month_param(month_param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="46">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    return Date.current.month if month_param.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="48">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">    month = month_param.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">    # Validate month is between 1-12</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="50">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">    month &gt;= 1 &amp;&amp; month &lt;= 12 ? month : Date.current.month</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def parse_bonus_event_param(bonus_event_param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="54">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    return &quot;all&quot; if bonus_event_param.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">    # Validate bonus_event is in the allowed list or &quot;all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="57">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    valid_events = Bonus::EVENT_TYPES + [ &quot;all&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="58">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    valid_events.include?(bonus_event_param) ? bonus_event_param : &quot;all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def generate_heatmap_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby">    #   </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="63">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    bonuses_query = Bonus.where(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">      availability_start_date: @start_date.beginning_of_day..@end_date.end_of_day</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">    #    ,  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="68">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    if @bonus_event != &quot;all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      bonuses_query = bonuses_query.where(event: @bonus_event)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby">    #       </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="73">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    bonuses_by_date = bonuses_query</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby">      .group(&quot;DATE(availability_start_date)&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby">      .count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby">    #        </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="78">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    heatmap_data = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">    #      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="80">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    max_count_for_color = 10.0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="82">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    (@start_date..@end_date).each do |date|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1879" data-linenumber="83">
            
              <span class="hits">1879</span>
            

            

            <code class="ruby">      date_key = date.strftime(&quot;%Y-%m-%d&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1879" data-linenumber="84">
            
              <span class="hits">1879</span>
            

            

            <code class="ruby">      count = bonuses_by_date[date_key] || 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby">      #   ( 0  1)    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1879" data-linenumber="87">
            
              <span class="hits">1879</span>
            

            

            <code class="ruby">      intensity = [ count.to_f / max_count_for_color, 1.0 ].min</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1879" data-linenumber="89">
            
              <span class="hits">1879</span>
            

            

            <code class="ruby">      heatmap_data[date_key] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby">        count: count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby">        intensity: intensity,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby">        date: date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="96">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    heatmap_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c46b5057ab25e6d1b989cf8ff249b7d05f400cbb">
  <div class="header">
    <h3>app/controllers/marketing_controller.rb</h3>
    <h4>
      <span class="green">
  98.21%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>56</b> relevant lines.
      <span class="green"><b>55</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class MarketingController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_marketing_request, only: [ :show, :edit, :update, :destroy, :activate, :reject, :transfer ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="5">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">    @current_tab = params[:tab] || MarketingRequest::REQUEST_TYPES.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">    # Start with base query - filter by tab only if no search or status filter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="8">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">    if params[:search].present? || params[:status].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="9">
            
              <span class="hits">16</span>
            

            

            <code class="ruby">      @marketing_requests = MarketingRequest.all.order(:created_at)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="11">
            
              <span class="hits">11</span>
            

            

            <code class="ruby">      @marketing_requests = MarketingRequest.by_request_type(@current_tab).order(:created_at)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">    # Filter by status if provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="15">
            
              <span class="hits">26</span>
            

            

            <code class="ruby">    if params[:status].present? &amp;&amp; MarketingRequest::STATUSES.include?(params[:status])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="16">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      @marketing_requests = @marketing_requests.by_status(params[:status])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">    # Search functionality</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="20">
            
              <span class="hits">26</span>
            

            

            <code class="ruby">    if params[:search].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="21">
            
              <span class="hits">11</span>
            

            

            <code class="ruby">      search_term = params[:search].strip.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="22">
            
              <span class="hits">11</span>
            

            

            <code class="ruby">      @marketing_requests = @marketing_requests.where(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">        &quot;LOWER(promo_code) LIKE ? OR LOWER(stag) LIKE ? OR LOWER(manager) LIKE ? OR LOWER(partner_email) LIKE ?&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">        &quot;%#{search_term}%&quot;, &quot;%#{search_term}%&quot;, &quot;%#{search_term}%&quot;, &quot;%#{search_term}%&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="28">
            
              <span class="hits">26</span>
            

            

            <code class="ruby">    @tabs = MarketingRequest::REQUEST_TYPES.map do |type|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="182" data-linenumber="30">
            
              <span class="hits">182</span>
            

            

            <code class="ruby">        key: type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">        label: MarketingRequest::REQUEST_TYPE_LABELS[type],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">        count: MarketingRequest.by_request_type(type).count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="41">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    @marketing_request = MarketingRequest.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="42">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:request_type].present? &amp;&amp; MarketingRequest::REQUEST_TYPES.include?(params[:request_type])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @marketing_request.request_type = params[:request_type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="48">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">    @marketing_request = MarketingRequest.new(marketing_request_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="50">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">    if @marketing_request.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="51">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      redirect_to marketing_index_path(tab: @marketing_request.request_type),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby">                  notice: &quot;  .&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="54">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="62">
            
              <span class="hits">15</span>
            

            

            <code class="ruby">    if @marketing_request.update(marketing_request_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="63">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      redirect_to marketing_index_path(tab: @marketing_request.request_type),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">                  notice: &quot;  .&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="66">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      render :edit, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="71">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    tab = @marketing_request.request_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="72">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @marketing_request.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="73">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    redirect_to marketing_index_path(tab: tab),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby">                notice: &quot;  .&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def activate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="78">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    @marketing_request.activate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="79">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    redirect_to marketing_index_path(tab: @marketing_request.request_type),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">                notice: &quot; .&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby">  rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    redirect_to marketing_index_path(tab: @marketing_request.request_type),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">                alert: &quot;  : #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def reject</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="87">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @marketing_request.reject!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="88">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    redirect_to marketing_index_path(tab: @marketing_request.request_type),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">                notice: &quot; .&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby">  rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            

            

            <code class="ruby">    redirect_to marketing_index_path(tab: @marketing_request.request_type),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby">                alert: &quot;  : #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="95">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def transfer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="96">
            
              <span class="hits">11</span>
            

            

            <code class="ruby">    new_request_type = params[:new_request_type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="98">
            
              <span class="hits">11</span>
            

            

            <code class="ruby">    unless MarketingRequest::REQUEST_TYPES.include?(new_request_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="99">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      redirect_to marketing_path(@marketing_request),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby">                  alert: &quot;    .&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="101">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="104">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    old_type = @marketing_request.request_type_label</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="105">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    old_request_type = @marketing_request.request_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="107">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    @marketing_request.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            

            <code class="ruby">      request_type: new_request_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            

            <code class="ruby">      status: &quot;pending&quot;,  #    pending  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby">      activation_date: nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="113">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    redirect_to marketing_index_path(tab: new_request_type),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby">                notice: &quot;   \&quot;#{old_type}\&quot;  \&quot;#{@marketing_request.request_type_label}\&quot;.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            

            <code class="ruby">  rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    redirect_to marketing_path(@marketing_request),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            

            <code class="ruby">                alert: &quot;  : #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="120">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="122">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_marketing_request</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="123">
            
              <span class="hits">58</span>
            

            

            <code class="ruby">    @marketing_request = MarketingRequest.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="126">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def marketing_request_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="127">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">    params.require(:marketing_request).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby">      :manager, :platform, :partner_email, :promo_code,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            

            <code class="ruby">      :stag, :activation_date, :status, :request_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5237a72b5ef69814d2861c455d17dd2016016380">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module ApplicationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="40c4f1eddb18070c25dfaa7b9c83372ab3438581">
  <div class="header">
    <h3>app/helpers/bonuses_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>36</b> relevant lines.
      <span class="green"><b>36</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module BonusesHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def status_badge_class(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="134" data-linenumber="3">
            
              <span class="hits">134</span>
            

            

            <code class="ruby">    case status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">    when &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="105" data-linenumber="5">
            
              <span class="hits">105</span>
            

            

            <code class="ruby">      &quot;bg-success&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">    when &quot;inactive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="7">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      &quot;bg-secondary&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">    when &quot;expired&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="9">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      &quot;bg-danger&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    when &quot;draft&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="11">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      &quot;bg-danger&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="13">
            
              <span class="hits">20</span>
            

            

            <code class="ruby">      &quot;bg-secondary&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def processing_status_badge_class(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="18">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    case status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">    when &quot;pending&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      &quot;bg-warning&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">    when &quot;processing&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      &quot;bg-info&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">    when &quot;completed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      &quot;bg-success&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">    when &quot;failed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      &quot;bg-danger&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">    when &quot;paused&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      &quot;bg-secondary&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="30">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      &quot;bg-secondary&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def event_type_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="36">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">      [ &quot;Deposit Event&quot;, &quot;deposit&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">      [ &quot;Input Coupon Event&quot;, &quot;input_coupon&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">      [ &quot;Manual Event&quot;, &quot;manual&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">      [ &quot;Collection Event&quot;, &quot;collection&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">      [ &quot;Groups Update Event&quot;, &quot;groups_update&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">      [ &quot;Scheduler Event&quot;, &quot;scheduler&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">  # Deprecated - use event_type_options instead</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_type_options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="47">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    event_type_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def status_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="52">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      [ &quot;Draft&quot;, &quot;draft&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby">      [ &quot;Active&quot;, &quot;active&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby">      [ &quot;Inactive&quot;, &quot;inactive&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">      [ &quot;Expired&quot;, &quot;expired&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currency_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="61">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      [ &quot;USD&quot;, &quot;USD&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby">      [ &quot;EUR&quot;, &quot;EUR&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">      [ &quot;GBP&quot;, &quot;GBP&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">      [ &quot;BTC&quot;, &quot;BTC&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">      [ &quot;ETH&quot;, &quot;ETH&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def project_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="71">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      [ &quot;VOLNA&quot;, &quot;VOLNA&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby">      [ &quot;ROX&quot;, &quot;ROX&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby">      [ &quot;FRESH&quot;, &quot;FRESH&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby">      [ &quot;SOL&quot;, &quot;SOL&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby">      [ &quot;JET&quot;, &quot;JET&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby">      [ &quot;IZZI&quot;, &quot;IZZI&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby">      [ &quot;LEGZO&quot;, &quot;LEGZO&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">      [ &quot;STARDA&quot;, &quot;STARDA&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">      [ &quot;DRIP&quot;, &quot;DRIP&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">      [ &quot;MONRO&quot;, &quot;MONRO&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby">      [ &quot;1GO&quot;, &quot;1GO&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby">      [ &quot;LEX&quot;, &quot;LEX&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">      [ &quot;GIZBO&quot;, &quot;GIZBO&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby">      [ &quot;IRWIN&quot;, &quot;IRWIN&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby">      [ &quot;FLAGMAN&quot;, &quot;FLAGMAN&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby">      [ &quot;MARTIN&quot;, &quot;MARTIN&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            

            <code class="ruby">      [ &quot;P17&quot;, &quot;P17&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            

            <code class="ruby">      [ &quot;ANJUAN&quot;, &quot;ANJUAN&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">      [ &quot;NAMASTE&quot;, &quot;NAMASTE&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def wagering_strategy_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="95">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      [ &quot;Wager&quot;, &quot;wager&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby">      [ &quot;Wager Win&quot;, &quot;wager_win&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby">      [ &quot;Wager Free&quot;, &quot;wager_free&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            

            <code class="ruby">      [ &quot;Insurance Bonus&quot;, &quot;insurance_bonus&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            

            <code class="ruby">      [ &quot;Wager Real&quot;, &quot;wager_real&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="103">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def collection_type_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="105">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">      [ &quot;Daily&quot;, &quot;daily&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            

            <code class="ruby">      [ &quot;Weekly&quot;, &quot;weekly&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby">      [ &quot;Monthly&quot;, &quot;monthly&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            

            <code class="ruby">      [ &quot;Fixed Amount&quot;, &quot;fixed_amount&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            

            <code class="ruby">      [ &quot;Percentage&quot;, &quot;percentage&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="113">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def collection_frequency_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="115">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      [ &quot;Daily&quot;, &quot;daily&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            

            <code class="ruby">      [ &quot;Weekly&quot;, &quot;weekly&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            

            <code class="ruby">      [ &quot;Monthly&quot;, &quot;monthly&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            

            <code class="ruby">      [ &quot;Once&quot;, &quot;once&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="122">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def schedule_type_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="124">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      [ &quot;Recurring&quot;, &quot;recurring&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            

            <code class="ruby">      [ &quot;One Time&quot;, &quot;one_time&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            

            <code class="ruby">      [ &quot;Cron Based&quot;, &quot;cron_based&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            

            <code class="ruby">      [ &quot;Interval Based&quot;, &quot;interval_based&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="131">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update_type_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="133">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      [ &quot;Add Bonus&quot;, &quot;add_bonus&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            

            <code class="ruby">      [ &quot;Remove Bonus&quot;, &quot;remove_bonus&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            

            <code class="ruby">      [ &quot;Modify Bonus&quot;, &quot;modify_bonus&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            

            <code class="ruby">      [ &quot;Bulk Apply&quot;, &quot;bulk_apply&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9bc355a30dd9a82aae4a5459eeba9148803f540d">
  <div class="header">
    <h3>app/helpers/heatmap_helper.rb</h3>
    <h4>
      <span class="green">
  95.83%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>24</b> relevant lines.
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module HeatmapHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def heatmap_color(intensity, is_current_month = true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="3">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">    return &quot;background-color: #f8f9fa;&quot; unless is_current_month</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby">    # Handle edge cases - convert to float first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="6">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">    intensity = intensity.to_f rescue 0.0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="7">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">    return &quot;background-color: #ffffff;&quot; if intensity &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">    # Ensure intensity is within valid range</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="10">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    intensity = [ intensity, 1.0 ].min</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    #  :     </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">    # intensity  0  1,  1  10+ </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="14">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    case intensity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">    when 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            

            <code class="ruby">      &quot;background-color: #ffffff;&quot; #    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    when 0.01..0.2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">      # -  (1-2 )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="19">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      &quot;background-color: #c6e48b;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">    when 0.21..0.4</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">      # -  (3-4 )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="22">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      &quot;background-color: #7bc96f;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">    when 0.41..0.6</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">      # -  (5-6 )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="25">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      &quot;background-color: #239a3b;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">    when 0.61..0.8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">      #  -  (7-8 )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="28">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      &quot;background-color: #d73027;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">      #   (9-10+ )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="31">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      &quot;background-color: #a50026;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def format_month_year(date)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="36">
            
              <span class="hits">11</span>
            

            

            <code class="ruby">    date.strftime(&quot;%B %Y&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bonus_type_badge_class(bonus_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="40">
            
              <span class="hits">35</span>
            

            

            <code class="ruby">    case bonus_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">    when &quot;deposit&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="42">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      &quot;bg-success&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">    when &quot;input_coupon&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="44">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      &quot;bg-primary&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">    when &quot;manual&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="46">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      &quot;bg-warning&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">    when &quot;collection&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="48">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      &quot;bg-info&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">    when &quot;groups_update&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="50">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      &quot;bg-secondary&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">    when &quot;scheduler&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="52">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      &quot;bg-dark&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="54">
            
              <span class="hits">15</span>
            

            

            <code class="ruby">      &quot;bg-light text-dark&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="67ebc1fc17228ec657daca77f855b586eae4cbd4">
  <div class="header">
    <h3>app/helpers/marketing_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>29</b> relevant lines.
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module MarketingHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def marketing_status_badge_class(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="3">
            
              <span class="hits">115</span>
            

            

            <code class="ruby">    case status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">    when &quot;pending&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="5">
            
              <span class="hits">103</span>
            

            

            <code class="ruby">      &quot;bg-warning&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">    when &quot;activated&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      &quot;bg-success&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">    when &quot;rejected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="9">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      &quot;bg-danger&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="11">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      &quot;bg-secondary&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def request_type_icon(request_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="129" data-linenumber="16">
            
              <span class="hits">129</span>
            

            

            <code class="ruby">    case request_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    when &quot;promo_webs_50&quot;, &quot;promo_webs_100&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="107" data-linenumber="18">
            
              <span class="hits">107</span>
            

            

            <code class="ruby">      &quot;fas fa-globe&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">    when &quot;promo_no_link_50&quot;, &quot;promo_no_link_100&quot;, &quot;promo_no_link_125&quot;, &quot;promo_no_link_150&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="20">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      &quot;fas fa-link&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">    when &quot;deposit_bonuses_partners&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="22">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      &quot;fas fa-credit-card&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="24">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">      &quot;fas fa-gift&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def format_platform_display(platform)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="29">
            
              <span class="hits">41</span>
            

            

            <code class="ruby">    return content_tag(:span, &quot;&quot;, class: &quot;text-muted&quot;) if platform.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">    # Security check: block javascript: and data: URLs to prevent XSS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="32">
            
              <span class="hits">38</span>
            

            

            <code class="ruby">    return truncate(platform, length: 50) if platform.start_with?(&quot;javascript:&quot;, &quot;data:&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="34">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">    if platform.match?(URI::DEFAULT_PARSER.make_regexp)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="35">
            
              <span class="hits">22</span>
            

            

            <code class="ruby">      display_text = &quot;#{truncate(platform, length: 30)} #{content_tag(:i, &#39;&#39;, class: &#39;fas fa-external-link-alt ms-1&#39;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="36">
            
              <span class="hits">22</span>
            

            

            <code class="ruby">      link_to display_text.html_safe, platform, target: &quot;_blank&quot;, class: &quot;text-primary text-decoration-none&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="38">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">      truncate(platform, length: 50)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def marketing_request_summary(request)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="43">
            
              <span class="hits">60</span>
            

            

            <code class="ruby">    &quot;#{request.request_type_label} - #{request.promo_code} (#{request.status_label})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def tab_count_badge(count)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">    # Handle edge cases: convert to integer safely</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="114" data-linenumber="48">
            
              <span class="hits">114</span>
            

            

            <code class="ruby">    count = case count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">    when Numeric</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="109" data-linenumber="50">
            
              <span class="hits">109</span>
            

            

            <code class="ruby">              count.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">    when String</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="52">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">              count.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="54">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">              0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="114" data-linenumber="57">
            
              <span class="hits">114</span>
            

            

            <code class="ruby">    return &quot;&quot; if count &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="108" data-linenumber="59">
            
              <span class="hits">108</span>
            

            

            <code class="ruby">    content_tag(:span, count, class: &quot;badge bg-secondary ms-1&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="75ab4ba964731c00f4d25b18bec5b1d0ff7e1a7b">
  <div class="header">
    <h3>app/jobs/application_job.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1">
            

            

            <code class="ruby">class ApplicationJob &lt; ActiveJob::Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">  # Automatically retry jobs that encountered a deadlock</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">  # retry_on ActiveRecord::Deadlocked</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby">  # Most jobs are safe to ignore if the underlying records are no longer available</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">  # discard_on ActiveJob::DeserializationError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7d5d68ba9fbd67851e6eefe5745845e97302ed4c">
  <div class="header">
    <h3>app/mailers/application_mailer.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1">
            

            

            <code class="ruby">class ApplicationMailer &lt; ActionMailer::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="2">
            

            

            <code class="ruby">  default from: &quot;from@example.com&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            

            <code class="ruby">  layout &quot;mailer&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="290be0e57251fc6bc1e5545ea37ea65d8e750721">
  <div class="header">
    <h3>app/models/application_record.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class ApplicationRecord &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  primary_abstract_class</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="77d0c87e180a58e19ad08c928ae3126d60aa0698">
  <div class="header">
    <h3>app/models/bonus.rb</h3>
    <h4>
      <span class="green">
  90.2%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>204</b> relevant lines.
      <span class="green"><b>184</b> lines covered</span> and
      <span class="red"><b>20</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class Bonus &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">  # Explicitly set table name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  self.table_name = &quot;bonuses&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby">  # Status and type constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  STATUSES = %w[draft active inactive expired].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  EVENT_TYPES = %w[deposit input_coupon manual collection groups_update scheduler].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  PROJECTS = %w[VOLNA ROX FRESH SOL JET IZZI LEGZO STARDA DRIP MONRO 1GO LEX GIZBO IRWIN FLAGMAN MARTIN P17 ANJUAN NAMASTE].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">  # Permanent bonus types for preview cards</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">  PERMANENT_BONUS_TYPES = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    { name: &quot;Welcome Bonus&quot;, slug: &quot;welcome_bonus&quot;, dsl_tag: &quot;welcome_bonus&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">    { name: &quot;Second Bonus&quot;, slug: &quot;second_bonus&quot;, dsl_tag: &quot;second&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">    { name: &quot;Third Bonus&quot;, slug: &quot;third_bonus&quot;, dsl_tag: &quot;third&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">    { name: &quot;Fourth Bonus&quot;, slug: &quot;fourth_bonus&quot;, dsl_tag: &quot;fourth&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">    { name: &quot;Reload Cash&quot;, slug: &quot;reload_cash&quot;, dsl_tag: &quot;reload_cash&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    { name: &quot;Reload Freespins&quot;, slug: &quot;reload_freespins&quot;, dsl_tag: &quot;reload_freespins&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">    { name: &quot;Happy Birthday Bonus&quot;, slug: &quot;happy_birthday&quot;, dsl_tag: &quot;birthday&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">    { name: &quot;Cashback Bonus&quot;, slug: &quot;cashback&quot;, dsl_tag: &quot;cashback&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">    { name: &quot;Live Cashback Bonus&quot;, slug: &quot;live_cashback&quot;, dsl_tag: &quot;live_cashback&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">  # New reward associations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :bonus_rewards, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :freespin_rewards, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :bonus_buy_rewards, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :comp_point_rewards, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :bonus_code_rewards, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :freechip_rewards, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :bonus_code_rewards, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :material_prize_rewards, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :comp_point_rewards, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">  # Store JSON data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :currencies, coder: JSON</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :groups, coder: JSON</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :currency_minimum_deposits, coder: JSON</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">  # Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :name, presence: true, length: { maximum: 255 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :code, presence: true, uniqueness: true, length: { maximum: 50 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :event, presence: true, inclusion: { in: EVENT_TYPES }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :status, presence: true, inclusion: { in: STATUSES }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :availability_start_date, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :availability_end_date, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :currency, presence: true, length: { maximum: 3 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :project, inclusion: { in: PROJECTS }, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :dsl_tag, length: { maximum: 255 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :description, length: { maximum: 1000 }, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate :end_date_after_start_date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate :valid_decimal_fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate :minimum_deposit_for_appropriate_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate :valid_currency_minimum_deposits</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="59">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">  scope :draft, -&gt; { where(status: &quot;draft&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="83" data-linenumber="60">
            
              <span class="hits">83</span>
            

            

            <code class="ruby">  scope :active, -&gt; { where(status: &quot;active&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="61">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">  scope :inactive, -&gt; { where(status: &quot;inactive&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="62">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">  scope :expired, -&gt; { where(status: &quot;expired&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="63">
            
              <span class="hits">15</span>
            

            

            <code class="ruby">  scope :by_event, -&gt;(event) { where(event: event) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="64">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">  scope :by_currency, -&gt;(currency) { where(currency: currency) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="65">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">  scope :by_country, -&gt;(country) { where(country: country) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="66">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">  scope :by_project, -&gt;(project) { where(project: project) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="67">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">  scope :by_dsl_tag, -&gt;(dsl_tag) { where(&quot;dsl_tag LIKE ?&quot;, &quot;%#{dsl_tag}%&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="68">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">  scope :available_now, -&gt; { where(&quot;availability_start_date &lt;= ? AND availability_end_date &gt;= ?&quot;, Time.current, Time.current) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="70">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">  scope :deposit_event, -&gt; { where(event: &quot;deposit&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="71">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">  scope :input_coupon_event, -&gt; { where(event: &quot;input_coupon&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  scope :manual_event, -&gt; { where(event: &quot;manual&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  scope :collection_event, -&gt; { where(event: &quot;collection&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  scope :groups_update_event, -&gt; { where(event: &quot;groups_update&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  scope :scheduler_event, -&gt; { where(event: &quot;scheduler&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2692" data-linenumber="78">
            
              <span class="hits">2692</span>
            

            

            <code class="ruby">  before_validation :generate_code, if: -&gt; { code.blank? }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="79">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_validation :set_currency_from_currencies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  after_find :check_and_update_expired_status!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby">  # Class methods for permanent bonuses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def self.find_permanent_bonus_for_project(project, dsl_tag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="84">
            
              <span class="hits">69</span>
            

            

            <code class="ruby">    where(project: project, dsl_tag: dsl_tag).active.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def self.permanent_bonus_previews_for_project(project)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="88">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">    return [] if project.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="90">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    PERMANENT_BONUS_TYPES.map do |bonus_type|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="91">
            
              <span class="hits">63</span>
            

            

            <code class="ruby">      existing_bonus = find_permanent_bonus_for_project(project, bonus_type[:dsl_tag])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="92">
            
              <span class="hits">63</span>
            

            

            <code class="ruby">      bonus_type.merge(existing_bonus: existing_bonus)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby">  # Instance methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="97">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def active?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="98">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    status == &quot;active&quot; &amp;&amp; available_now?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="101">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def available_now?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="102">
            
              <span class="hits">20</span>
            

            

            <code class="ruby">    Time.current.between?(availability_start_date, availability_end_date)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def expired?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="594" data-linenumber="106">
            
              <span class="hits">594</span>
            

            

            <code class="ruby">    availability_end_date &lt; Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            

            <code class="ruby">  # Legacy method - deprecated, use new reward system</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="110">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def type_specific_record</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            

            <code class="ruby">    # This method is deprecated. Use the new reward associations:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            

            <code class="ruby">    # bonus_rewards, freespin_rewards, bonus_buy_rewards, etc.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="113">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            

            <code class="ruby">  # New methods for working with rewards</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="117">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def all_rewards</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="119">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">      bonus_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby">      freespin_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            

            <code class="ruby">      bonus_buy_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            

            <code class="ruby">      freechip_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            

            <code class="ruby">      bonus_code_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            

            <code class="ruby">      material_prize_rewards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            

            <code class="ruby">      comp_point_rewards</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            

            <code class="ruby">    ].flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="129">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def has_rewards?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="130">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    all_rewards.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="133">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def reward_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="134">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    types = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="135">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    types &lt;&lt; &quot;bonus&quot; if bonus_rewards.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="136">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    types &lt;&lt; &quot;freespins&quot; if freespin_rewards.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="137">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    types &lt;&lt; &quot;bonus_buy&quot; if bonus_buy_rewards.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="138">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    types &lt;&lt; &quot;freechips&quot; if freechip_rewards.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="139">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    types &lt;&lt; &quot;bonus_code&quot; if bonus_code_rewards.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="140">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    types &lt;&lt; &quot;material_prize&quot; if material_prize_rewards.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="141">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    types &lt;&lt; &quot;comp_point&quot; if comp_point_rewards.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="142">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    types</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            

            <code class="ruby">  # Methods to get data from rewards for display in table</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="146">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def display_code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            

            <code class="ruby">    # Try to get code from first reward, fallback to bonus code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="148">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    first_reward = all_rewards.first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="149">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    first_reward&amp;.code || code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="152">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def display_currency</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            

            <code class="ruby">    # Try to get currency from first reward, fallback to bonus currency</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="154">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    first_reward = all_rewards.first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="155">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    if first_reward&amp;.respond_to?(:currencies) &amp;&amp; first_reward.currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="156">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      first_reward.currencies.is_a?(Array) ? first_reward.currencies.join(&quot;, &quot;) : first_reward.currencies</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="158">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      currency</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="162">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def display_country</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            

            <code class="ruby">    # Try to get country from first reward, fallback to bonus country</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="164">
            

            

            <code class="ruby">    first_reward = all_rewards.first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            

            

            <code class="ruby">    if first_reward&amp;.respond_to?(:current_ip_country) &amp;&amp; first_reward.current_ip_country.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            

            

            <code class="ruby">      first_reward.current_ip_country</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="167">
            

            

            <code class="ruby">    elsif first_reward&amp;.respond_to?(:profile_country) &amp;&amp; first_reward.profile_country.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="168">
            

            

            <code class="ruby">      first_reward.profile_country</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="169">
            

            

            <code class="ruby">    elsif first_reward&amp;.respond_to?(:last_login_country) &amp;&amp; first_reward.last_login_country.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="170">
            

            

            <code class="ruby">      first_reward.last_login_country</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="172">
            

            

            <code class="ruby">      country</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="176">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def display_tags</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            

            <code class="ruby">    # Try to get tags from first reward, fallback to bonus tags</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            

            

            <code class="ruby">    first_reward = all_rewards.first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="179">
            

            

            <code class="ruby">    if first_reward&amp;.respond_to?(:tags) &amp;&amp; first_reward.tags.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="180">
            

            

            <code class="ruby">      first_reward.tags.is_a?(Array) ? first_reward.tags.join(&quot;, &quot;) : first_reward.tags</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="182">
            

            

            <code class="ruby">      tags</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="186">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def display_user_group</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            

            <code class="ruby">    # Try to get groups from first reward, fallback to bonus user_group</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="188">
            

            

            <code class="ruby">    first_reward = all_rewards.first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="189">
            

            

            <code class="ruby">    if first_reward&amp;.respond_to?(:groups) &amp;&amp; first_reward.groups.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="190">
            

            

            <code class="ruby">      first_reward.groups.is_a?(Array) ? first_reward.groups.join(&quot;, &quot;) : first_reward.groups</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="192">
            

            

            <code class="ruby">      user_group</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="196">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def tags_array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="197">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    return [] if tags.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="198">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    tags.split(&quot;,&quot;).map(&amp;:strip)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="201">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def tags_array=(array)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="202">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    self.tags = array.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            

            <code class="ruby">  # Currencies methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="206">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currencies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5625" data-linenumber="207">
            
              <span class="hits">5625</span>
            

            

            <code class="ruby">    super || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="210">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currencies=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3008" data-linenumber="211">
            
              <span class="hits">3008</span>
            

            

            <code class="ruby">    if value.is_a?(Array)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3003" data-linenumber="212">
            
              <span class="hits">3003</span>
            

            

            <code class="ruby">      super(value.reject(&amp;:blank?))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="213">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    elsif value.is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="214">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      super(value.split(&quot;,&quot;).map(&amp;:strip).reject(&amp;:blank?))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="216">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      super(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="220">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_currencies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="221">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    currencies.join(&quot;, &quot;) if currencies.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            

            <code class="ruby">  # Groups methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="225">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def groups</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="492" data-linenumber="226">
            
              <span class="hits">492</span>
            

            

            <code class="ruby">    super || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="229">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def groups=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3000" data-linenumber="230">
            
              <span class="hits">3000</span>
            

            

            <code class="ruby">    if value.is_a?(Array)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2995" data-linenumber="231">
            
              <span class="hits">2995</span>
            

            

            <code class="ruby">      super(value.reject(&amp;:blank?))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="232">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    elsif value.is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="233">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      super(value.split(&quot;,&quot;).map(&amp;:strip).reject(&amp;:blank?))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="235">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      super(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="239">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_groups</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="240">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    groups.join(&quot;, &quot;) if groups.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            

            <code class="ruby">  # Currency minimum deposits methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="244">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currency_minimum_deposits</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8303" data-linenumber="245">
            
              <span class="hits">8303</span>
            

            

            <code class="ruby">    super || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="248">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currency_minimum_deposits=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3021" data-linenumber="249">
            
              <span class="hits">3021</span>
            

            

            <code class="ruby">    if value.is_a?(Hash)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            

            <code class="ruby">      # Remove blank values and convert to proper format</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5957" data-linenumber="251">
            
              <span class="hits">5957</span>
            

            

            <code class="ruby">      clean_value = value.reject { |_k, v| v.blank? }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5955" data-linenumber="252">
            
              <span class="hits">5955</span>
            

            

            <code class="ruby">      clean_value = clean_value.transform_values { |v| v.to_f }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3021" data-linenumber="253">
            
              <span class="hits">3021</span>
            

            

            <code class="ruby">      super(clean_value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="254">
            

            

            <code class="ruby">    elsif value.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="255">
            

            

            <code class="ruby">      super({})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="257">
            

            

            <code class="ruby">      super(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="261">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_currency_minimum_deposits</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="262">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    return &quot;No minimum deposits specified&quot; if currency_minimum_deposits.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="264">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    currency_minimum_deposits.map { |currency, amount| &quot;#{currency}: #{amount}&quot; }.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="267">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def minimum_deposit_for_currency(currency)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="268">
            
              <span class="hits">15</span>
            

            

            <code class="ruby">    currency_minimum_deposits[currency.to_s]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="271">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def has_minimum_deposit_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="272">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    currency_minimum_deposits.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            

            <code class="ruby">  # Limitation methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="276">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_no_more</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="277">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    no_more.present? ? no_more : &quot;No limit&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="280">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_totally_no_more</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="281">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    totally_no_more.present? ? &quot;#{totally_no_more} total&quot; : &quot;Unlimited&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="284">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def activate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="285">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    update!(status: &quot;active&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="288">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def deactivate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="289">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    update!(status: &quot;inactive&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="292">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def mark_as_expired!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="293">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    update!(status: &quot;expired&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="296">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def check_and_update_expired_status!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="587" data-linenumber="297">
            
              <span class="hits">587</span>
            

            

            <code class="ruby">    return unless persisted? # Only check saved records</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            

            <code class="ruby">    # If bonus has expired and is still active, mark it as inactive</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="586" data-linenumber="300">
            
              <span class="hits">586</span>
            

            

            <code class="ruby">    if expired? &amp;&amp; status == &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="301">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      update_column(:status, &quot;inactive&quot;) # Use update_column to avoid callbacks loop</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            

            <code class="ruby">  # Class method to update all expired bonuses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="306">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def self.update_expired_bonuses!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="307">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    active.where(&quot;availability_end_date &lt; ?&quot;, Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            

            <code class="ruby">          .update_all(status: &quot;inactive&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="311">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="313">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def end_date_after_start_date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2691" data-linenumber="314">
            
              <span class="hits">2691</span>
            

            

            <code class="ruby">    return unless availability_start_date &amp;&amp; availability_end_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2680" data-linenumber="316">
            
              <span class="hits">2680</span>
            

            

            <code class="ruby">    if availability_end_date &lt;= availability_start_date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="317">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      errors.add(:availability_end_date, &quot;must be after start date&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="321">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def valid_decimal_fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2691" data-linenumber="322">
            
              <span class="hits">2691</span>
            

            

            <code class="ruby">    validate_decimal_field(:minimum_deposit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2691" data-linenumber="323">
            
              <span class="hits">2691</span>
            

            

            <code class="ruby">    validate_decimal_field(:wager)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2691" data-linenumber="324">
            
              <span class="hits">2691</span>
            

            

            <code class="ruby">    validate_decimal_field(:maximum_winnings)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="327">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def validate_decimal_field(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8073" data-linenumber="328">
            
              <span class="hits">8073</span>
            

            

            <code class="ruby">    value = send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8073" data-linenumber="329">
            
              <span class="hits">8073</span>
            

            

            <code class="ruby">    return if value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7877" data-linenumber="331">
            
              <span class="hits">7877</span>
            

            

            <code class="ruby">    if value &lt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="332">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      errors.add(field, &quot;must be greater than or equal to 0&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="334">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="336">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def generate_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="337">
            
              <span class="hits">21</span>
            

            

            <code class="ruby">    loop do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="338">
            
              <span class="hits">21</span>
            

            

            <code class="ruby">      self.code = &quot;BONUS_#{SecureRandom.hex(4).upcase}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="339">
            
              <span class="hits">21</span>
            

            

            <code class="ruby">      break unless self.class.exists?(code: code)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="341">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="342">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="343">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_currency_from_currencies</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            

            

            <code class="ruby">    # Set currency from currencies array if currency is blank and currencies are present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2691" data-linenumber="345">
            
              <span class="hits">2691</span>
            

            

            <code class="ruby">    if currency.blank? &amp;&amp; currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="346">
            

            

            <code class="ruby">      self.currency = currencies.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="348">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="349">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="350">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def minimum_deposit_for_appropriate_types</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            

            

            <code class="ruby">    # minimum_deposit      ,    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2691" data-linenumber="352">
            
              <span class="hits">2691</span>
            

            

            <code class="ruby">    non_deposit_events = %w[input_coupon manual collection groups_update scheduler]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="353">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2691" data-linenumber="354">
            
              <span class="hits">2691</span>
            

            

            <code class="ruby">    if non_deposit_events.include?(event) &amp;&amp; minimum_deposit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="355">
            
              <span class="hits">11</span>
            

            

            <code class="ruby">      errors.add(:minimum_deposit, &quot;      #{event}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="356">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="358">
            

            

            <code class="ruby">    #    minimum_deposit     </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2691" data-linenumber="359">
            
              <span class="hits">2691</span>
            

            

            <code class="ruby">    if event == &quot;deposit&quot; &amp;&amp; minimum_deposit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="360">
            

            

            <code class="ruby">      #    - minimum_deposit    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="361">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="362">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="363">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="364">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def valid_currency_minimum_deposits</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2691" data-linenumber="365">
            
              <span class="hits">2691</span>
            

            

            <code class="ruby">    return if currency_minimum_deposits.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="366">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            

            

            <code class="ruby">    # ,  currency_minimum_deposits      ,    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2560" data-linenumber="368">
            
              <span class="hits">2560</span>
            

            

            <code class="ruby">    non_deposit_events = %w[input_coupon manual collection groups_update scheduler]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="369">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2560" data-linenumber="370">
            
              <span class="hits">2560</span>
            

            

            <code class="ruby">    if non_deposit_events.include?(event) &amp;&amp; currency_minimum_deposits.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="371">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      errors.add(:currency_minimum_deposits, &quot;      #{event}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="372">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="373">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="374">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="375">
            

            

            <code class="ruby">    # ,      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2554" data-linenumber="376">
            
              <span class="hits">2554</span>
            

            

            <code class="ruby">    currency_minimum_deposits.each do |currency, amount|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2557" data-linenumber="377">
            
              <span class="hits">2557</span>
            

            

            <code class="ruby">      if amount.blank? || amount.to_f &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="378">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">        errors.add(:currency_minimum_deposits, &quot;  #{currency}    &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="379">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="381">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="382">
            

            

            <code class="ruby">    # ,        </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2554" data-linenumber="383">
            
              <span class="hits">2554</span>
            

            

            <code class="ruby">    if currencies.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2553" data-linenumber="384">
            
              <span class="hits">2553</span>
            

            

            <code class="ruby">      invalid_currencies = currency_minimum_deposits.keys - currencies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2553" data-linenumber="385">
            
              <span class="hits">2553</span>
            

            

            <code class="ruby">      if invalid_currencies.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="386">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">        errors.add(:currency_minimum_deposits, &quot; ,       : #{invalid_currencies.join(&#39;, &#39;)}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="387">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="388">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2f52720eb3f56f0fa41e109b3ef60478bea5a3f9">
  <div class="header">
    <h3>app/models/bonus_buy_reward.rb</h3>
    <h4>
      <span class="green">
  93.65%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>63</b> relevant lines.
      <span class="green"><b>59</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class BonusBuyReward &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  include BonusCommonParameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :bonus</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :buy_amount, presence: true, numericality: { greater_than: 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :multiplier, numericality: { greater_than: 0 }, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">  # Store additional configuration as JSON</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :config, coder: JSON</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">  # Common parameters accessors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def games</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="14">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;games&quot;) || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def games=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="18">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    games_array = value.is_a?(Array) ? value : value.to_s.split(&quot;,&quot;).map(&amp;:strip).reject(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="19">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;games&quot; =&gt; games_array)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bet_level</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="23">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;bet_level&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bet_level=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="27">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;bet_level&quot; =&gt; value&amp;.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def max_win</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="31">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;max_win&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def max_win=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="35">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;max_win&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def max_win_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="39">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return &quot;multiplier&quot; if max_win.to_s.include?(&quot;x&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="40">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    &quot;fixed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def available</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;available&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def available=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="50">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;available&quot; =&gt; value&amp;.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def code</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            

            

            <code class="ruby">    config&amp;.dig(&quot;code&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def code=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;code&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def stag</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            

            

            <code class="ruby">    config&amp;.dig(&quot;stag&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def stag=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;stag&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby">  # Currency-specific bet levels</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currency_bet_levels</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="75">
            
              <span class="hits">13</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;currency_bet_levels&quot;) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currency_bet_levels=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="79">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;currency_bet_levels&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def get_bet_level_for_currency(currency)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="83">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    currency_bet_levels[currency.to_s] || bet_level</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_bet_level_for_currency(currency, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="87">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    levels = currency_bet_levels.dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="88">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    levels[currency.to_s] = value&amp;.to_f</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="89">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    self.currency_bet_levels = levels</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby">  # Advanced parameters accessors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def advanced_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="94">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @advanced_params ||= %w[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby">      auto_activate duration activation_duration email_template range last_login_country</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby">      profile_country current_ip_country emails stag deposit_payment_systems</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby">      cashout_payment_systems user_can_have_duplicates user_can_have_disposable_email</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            

            <code class="ruby">      total_deposits deposits_sum loss_sum deposits_count spend_sum category_loss_sum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            

            <code class="ruby">      wager_sum bets_count affiliates_user balance chargeable_comp_points</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby">      persistent_comp_points date_of_birth deposit gender issued_bonus registered</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            

            <code class="ruby">      social_networks wager_done hold_min hold_max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def get_advanced_param(param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="106">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    config&amp;.dig(param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="109">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_advanced_param(param, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="110">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return unless advanced_params.include?(param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="111">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(param =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="114">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_buy_amount</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="115">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    &quot;#{buy_amount} #{bonus.currency}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="118">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="119">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    multiplier.present? ? &quot;#{multiplier}x&quot; : &quot;N/A&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="122">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def has_game_restrictions?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="123">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    games.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="126">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_games</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="127">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    games.join(&quot;, &quot;) if games.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="130">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_max_win</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="131">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return &quot;No limit&quot; if max_win.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="132">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    return max_win if max_win.to_s.include?(&quot;x&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="133">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    &quot;#{max_win} #{bonus.currency}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a777f8a6a614411f55fcd3e36ce41370addae820">
  <div class="header">
    <h3>app/models/bonus_code_reward.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>20</b> relevant lines.
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class BonusCodeReward &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  include BonusCommonParameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :bonus</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">  # Serialize config as JSON for additional parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :config, coder: JSON</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :code, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :code_type, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">  # Config accessors for common parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def config</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="14">
            
              <span class="hits">35</span>
            

            

            <code class="ruby">    super || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">  # Helper methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_bonus_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="19">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    code.present? ? code.upcase : &quot;N/A&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="23">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    config[&quot;title&quot;] || &quot;- #{code}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def title=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="27">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;title&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def display_title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="31">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    title</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">  # For backward compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_bonus_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_bonus_code=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    self.code = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ade511c40c23e547c83bcfe738a77cfca3098cc0">
  <div class="header">
    <h3>app/models/bonus_reward.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>49</b> relevant lines.
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class BonusReward &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  include BonusCommonParameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :bonus</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :reward_type, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :amount, presence: true, numericality: { greater_than_or_equal_to: 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :percentage, numericality: { greater_than_or_equal_to: 0, less_than_or_equal_to: 100 }, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="10">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">  scope :by_type, -&gt;(type) { where(reward_type: type) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">  # Store additional configuration as JSON</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :config, coder: JSON</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">  # Common parameters accessors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def wager</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="17">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;wager&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def wager=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="21">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;wager&quot; =&gt; value&amp;.to_f)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def max_win</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="25">
            
              <span class="hits">11</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;max_win&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def max_win=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="29">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;max_win&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def max_win_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="33">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return &quot;multiplier&quot; if max_win.to_s.include?(&quot;x&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="34">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    &quot;fixed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def available</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;available&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def available=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="42">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;available&quot; =&gt; value&amp;.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="46">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;code&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def code=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;code&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def user_can_have_duplicates</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="56">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;user_can_have_duplicates&quot;) || false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def user_can_have_duplicates=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="60">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;user_can_have_duplicates&quot; =&gt; [ true, &quot;true&quot;, &quot;1&quot;, 1 ].include?(value))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def stag</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;stag&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def stag=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;stag&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby">  # Advanced parameters accessors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def advanced_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="77">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    @advanced_params ||= %w[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">      range last_login_country profile_country current_ip_country emails stag</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">      deposit_payment_systems cashout_payment_systems user_can_have_disposable_email</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">      total_deposits deposits_sum loss_sum deposits_count spend_sum category_loss_sum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby">      wager_sum bets_count affiliates_user balance cashout chargeable_comp_points</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby">      persistent_comp_points date_of_birth deposit gender issued_bonus registered</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">      social_networks hold_min hold_max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def get_advanced_param(param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="88">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    config&amp;.dig(param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="91">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_advanced_param(param, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="92">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return unless advanced_params.include?(param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="93">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(param =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_amount</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="97">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    return &quot;#{percentage}%&quot; if percentage.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="98">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    &quot;#{amount} #{bonus.currency}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="101">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_max_win</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="102">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return &quot;No limit&quot; if max_win.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="103">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    return max_win if max_win.to_s.include?(&quot;x&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    &quot;#{max_win} #{bonus.currency}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b8e2696113241e24e85f73a908b0fadf1f122933">
  <div class="header">
    <h3>app/models/comp_point_reward.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>19</b> relevant lines.
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class CompPointReward &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  include BonusCommonParameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :bonus</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">  # Serialize config as JSON for additional parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :config, coder: JSON</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :points_amount, presence: true, numericality: { greater_than_or_equal_to: 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :multiplier, numericality: { greater_than_or_equal_to: 0 }, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">  # Config accessors for common parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def config</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="14">
            
              <span class="hits">31</span>
            

            

            <code class="ruby">    super || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">  # Helper methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_points_amount</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="19">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    points_amount.present? ? &quot;#{points_amount} &quot; : &quot;0&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="23">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    multiplier.present? ? &quot;#{multiplier}&quot; : &quot;N/A&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="27">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    config[&quot;title&quot;] || &quot;#{points_amount} comp points&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def title=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="31">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;title&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def total_value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="35">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    return points_amount unless multiplier.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="36">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    points_amount * multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f6b4379cb0a0655d542b4c26faa4a1ff687354cf">
  <div class="header">
    <h3>app/models/concerns/bonus_common_parameters.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>30</b> relevant lines.
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module BonusCommonParameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">  #     </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currencies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="6">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    bonus.currencies || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">  #      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def groups</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="11">
            
              <span class="hits">19</span>
            

            

            <code class="ruby">    bonus.groups || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">  #     </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def tags</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="16">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">    bonus.tags&amp;.split(&quot;,&quot;)&amp;.map(&amp;:strip)&amp;.reject(&amp;:blank?) || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">  #      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def min_deposit_for_currency(currency)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="21">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    bonus.minimum_deposit_for_currency(currency)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">  #      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currency_minimum_deposits</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="26">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    bonus.currency_minimum_deposits</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">  #      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def no_more</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="31">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    bonus.no_more</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def totally_no_more</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="35">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    bonus.totally_no_more</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">  #      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def wagering_strategy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="40">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    bonus.wagering_strategy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">  #    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_currencies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="45">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    currencies.join(&quot;, &quot;) if currencies.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_groups</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="49">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    groups.join(&quot;, &quot;) if groups.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_tags</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="53">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    tags.join(&quot;, &quot;) if tags.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_no_more</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="57">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    no_more.present? ? no_more : &quot;No limit&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="60">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_totally_no_more</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="61">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    totally_no_more.present? ? &quot;#{totally_no_more} total&quot; : &quot;Unlimited&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">  # ,      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def has_minimum_deposit_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="66">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    bonus.has_minimum_deposit_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d6a1c9bbd628e883c66514003d4ddfd1cb09697f">
  <div class="header">
    <h3>app/models/freechip_reward.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class FreechipReward &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  include BonusCommonParameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :bonus</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :chip_value, presence: true, numericality: { greater_than: 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :chips_count, presence: true, numericality: { greater_than: 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def total_value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="10">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">    chip_value * chips_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_chip_value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="14">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    &quot;#{chip_value} #{bonus.currency}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_total_value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="18">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    &quot;#{total_value} #{bonus.currency}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c570f2c9548c1e04e0437d09387b88c19a154567">
  <div class="header">
    <h3>app/models/freespin_reward.rb</h3>
    <h4>
      <span class="green">
  93.33%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>60</b> relevant lines.
      <span class="green"><b>56</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class FreespinReward &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  include BonusCommonParameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :bonus</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :spins_count, presence: true, numericality: { greater_than: 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">  # Store additional configuration as JSON</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :config, coder: JSON</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">  # Common parameters accessors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def games</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="13">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;games&quot;) || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def games=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    games_array = value.is_a?(Array) ? value : value.to_s.split(&quot;,&quot;).map(&amp;:strip).reject(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="18">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;games&quot; =&gt; games_array)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bet_level</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="22">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;bet_level&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bet_level=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="26">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;bet_level&quot; =&gt; value&amp;.to_f)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def max_win</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="30">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;max_win&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def max_win=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="34">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;max_win&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def max_win_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="38">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return &quot;multiplier&quot; if max_win.to_s.include?(&quot;x&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="39">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    &quot;fixed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def available</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;available&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def available=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="49">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;available&quot; =&gt; value&amp;.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def code</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            

            <code class="ruby">    config&amp;.dig(&quot;code&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def code=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;code&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def stag</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            

            

            <code class="ruby">    config&amp;.dig(&quot;stag&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def stag=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;stag&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby">  # Currency-specific bet levels</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currency_bet_levels</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="74">
            
              <span class="hits">13</span>
            

            

            <code class="ruby">    config&amp;.dig(&quot;currency_bet_levels&quot;) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def currency_bet_levels=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="78">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(&quot;currency_bet_levels&quot; =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def get_bet_level_for_currency(currency)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="82">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    currency_bet_levels[currency.to_s] || bet_level</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="85">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_bet_level_for_currency(currency, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="86">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    levels = currency_bet_levels.dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="87">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    levels[currency.to_s] = value&amp;.to_f</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="88">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    self.currency_bet_levels = levels</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby">  # Advanced parameters accessors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def advanced_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="93">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    @advanced_params ||= %w[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">      auto_activate duration activation_duration email_template range last_login_country</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby">      profile_country current_ip_country emails stag deposit_payment_systems</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby">      cashout_payment_systems user_can_have_duplicates user_can_have_disposable_email</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby">      total_deposits deposits_sum loss_sum deposits_count spend_sum category_loss_sum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            

            <code class="ruby">      wager_sum bets_count affiliates_user balance chargeable_comp_points</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            

            <code class="ruby">      persistent_comp_points date_of_birth deposit gender issued_bonus registered</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby">      social_networks wager_done hold_min hold_max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def get_advanced_param(param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="105">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    config&amp;.dig(param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="108">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_advanced_param(param, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="109">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return unless advanced_params.include?(param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="110">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    self.config = (config || {}).merge(param =&gt; value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="113">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_spins</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="114">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    &quot;#{spins_count} #{&#39;spin&#39;.pluralize(spins_count)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="117">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def has_game_restrictions?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="118">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    games.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="121">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_games</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="122">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    games.join(&quot;, &quot;) if games.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_max_win</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="126">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return &quot;No limit&quot; if max_win.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="127">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    return max_win if max_win.to_s.include?(&quot;x&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="128">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    &quot;#{max_win} #{bonus.currency}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5a79d8d41e9da51fbb20179b312e2cda8c4ea3d1">
  <div class="header">
    <h3>app/models/marketing_request.rb</h3>
    <h4>
      <span class="green">
  99.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>100</b> relevant lines.
      <span class="green"><b>99</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class MarketingRequest &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">  # Constants for status and request types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  STATUSES = %w[pending activated rejected].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">  REQUEST_TYPES = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    &quot;promo_webs_50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">    &quot;promo_webs_100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">    &quot;promo_no_link_50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">    &quot;promo_no_link_100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">    &quot;promo_no_link_125&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    &quot;promo_no_link_150&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">    &quot;deposit_bonuses_partners&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">  REQUEST_TYPE_LABELS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    &quot;promo_webs_50&quot; =&gt; &quot;  50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">    &quot;promo_webs_100&quot; =&gt; &quot;  100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    &quot;promo_no_link_50&quot; =&gt; &quot;   50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">    &quot;promo_no_link_100&quot; =&gt; &quot;   100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">    &quot;promo_no_link_125&quot; =&gt; &quot;   125&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">    &quot;promo_no_link_150&quot; =&gt; &quot;   150&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">    &quot;deposit_bonuses_partners&quot; =&gt; &quot;   &quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">  STATUS_LABELS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    &quot;pending&quot; =&gt; &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">    &quot;activated&quot; =&gt; &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">    &quot;rejected&quot; =&gt; &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">  # Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :manager, presence: true, length: { maximum: 255 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :platform, length: { maximum: 1000 }, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :partner_email, presence: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">            format: { with: URI::MailTo::EMAIL_REGEXP, message: &quot;   email&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">            length: { maximum: 255 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :promo_code, presence: true, length: { maximum: 2000 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :stag, presence: true, length: { maximum: 50 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :status, presence: true, inclusion: { in: STATUSES }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :request_type, presence: true, inclusion: { in: REQUEST_TYPES }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">  # Custom validations based on partner rules</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate :stag_uniqueness_across_all_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate :promo_codes_uniqueness_across_all_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate :no_spaces_in_stag_and_codes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate :valid_promo_codes_format</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="48">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">  scope :by_status, -&gt;(status) { where(status: status) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="195" data-linenumber="49">
            
              <span class="hits">195</span>
            

            

            <code class="ruby">  scope :by_request_type, -&gt;(request_type) { where(request_type: request_type) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="50">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">  scope :pending, -&gt; { where(status: &quot;pending&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="51">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">  scope :activated, -&gt; { where(status: &quot;activated&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="52">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">  scope :rejected, -&gt; { where(status: &quot;rejected&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_validation :normalize_promo_code_and_stag</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_update :reset_to_pending_if_changed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby">  # Instance methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def status_label</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="60">
            
              <span class="hits">63</span>
            

            

            <code class="ruby">    STATUS_LABELS[status] || status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def request_type_label</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="86" data-linenumber="64">
            
              <span class="hits">86</span>
            

            

            <code class="ruby">    REQUEST_TYPE_LABELS[request_type] || request_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def pending?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="68">
            
              <span class="hits">20</span>
            

            

            <code class="ruby">    status == &quot;pending&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def activated?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    status == &quot;activated&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def rejected?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    status == &quot;rejected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="79">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def activate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="80">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    update!(status: &quot;activated&quot;, activation_date: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def reject!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="84">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    update!(status: &quot;rejected&quot;, activation_date: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def reset_to_pending!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="88">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    update!(status: &quot;pending&quot;, activation_date: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby">  # Methods for working with multiple promo codes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def promo_codes_array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2358" data-linenumber="93">
            
              <span class="hits">2358</span>
            

            

            <code class="ruby">    return [] if promo_code.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2355" data-linenumber="94">
            
              <span class="hits">2355</span>
            

            

            <code class="ruby">    promo_code.split(/[,\n\r]+/).map(&amp;:strip).reject(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="97">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def promo_codes_array=(codes_array)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="98">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    if codes_array.is_a?(Array)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="99">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      self.promo_code = codes_array.compact.map(&amp;:strip).reject(&amp;:blank?).join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="100">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    elsif codes_array.is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="101">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      self.promo_code = codes_array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_promo_codes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="106">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    codes = promo_codes_array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="107">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    return promo_code if codes.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="108">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    codes.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="111">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def first_promo_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="112">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    promo_codes_array.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            

            <code class="ruby">  # Check if this partner (stag) has other requests</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def existing_partner_request</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="117">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    return nil if stag.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="118">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    self.class.where(stag: stag).where.not(id: id).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="121">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def has_existing_partner_request?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="122">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    existing_partner_request.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="127">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def normalize_promo_code_and_stag</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby">    # Normalize promo codes - each code should be uppercase and trimmed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="789" data-linenumber="129">
            
              <span class="hits">789</span>
            

            

            <code class="ruby">    if promo_code.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="782" data-linenumber="130">
            
              <span class="hits">782</span>
            

            

            <code class="ruby">      normalized_codes = promo_code.split(/[,\n\r]+/).map(&amp;:strip).reject(&amp;:blank?).map(&amp;:upcase)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="782" data-linenumber="131">
            
              <span class="hits">782</span>
            

            

            <code class="ruby">      self.promo_code = normalized_codes.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            

            <code class="ruby">    # Normalize stag - remove spaces and keep case sensitivity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="789" data-linenumber="135">
            
              <span class="hits">789</span>
            

            

            <code class="ruby">    self.stag = stag&amp;.strip&amp;.gsub(/\s+/, &quot;&quot;) if stag.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="138">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def reset_to_pending_if_changed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            

            <code class="ruby">    #        &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            

            <code class="ruby">    #  -     activation_date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="141">
            
              <span class="hits">38</span>
            

            

            <code class="ruby">    changed_attrs = changed_attributes.keys - [ &quot;status&quot;, &quot;activation_date&quot;, &quot;updated_at&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="143">
            
              <span class="hits">38</span>
            

            

            <code class="ruby">    if changed_attrs.any? &amp;&amp; !pending?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="144">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      self.status = &quot;pending&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="145">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      self.activation_date = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            

            <code class="ruby">  # Partner rule validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="150">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def stag_uniqueness_across_all_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="789" data-linenumber="151">
            
              <span class="hits">789</span>
            

            

            <code class="ruby">    return if stag.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="783" data-linenumber="153">
            
              <span class="hits">783</span>
            

            

            <code class="ruby">    existing_request = self.class.where(stag: stag).where.not(id: id).first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="783" data-linenumber="154">
            
              <span class="hits">783</span>
            

            

            <code class="ruby">    if existing_request</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="155">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      errors.add(:stag, &quot;     \&quot;#{existing_request.request_type_label}\&quot; (ID: #{existing_request.id}). &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            

            <code class="ruby">                        &quot; ,        . &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            

            <code class="ruby">                        &quot;     STAG.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="161">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def promo_codes_uniqueness_across_all_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="789" data-linenumber="162">
            
              <span class="hits">789</span>
            

            

            <code class="ruby">    return if promo_code.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="782" data-linenumber="164">
            
              <span class="hits">782</span>
            

            

            <code class="ruby">    current_codes = promo_codes_array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="782" data-linenumber="165">
            
              <span class="hits">782</span>
            

            

            <code class="ruby">    return if current_codes.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            

            <code class="ruby">    # Check each code for uniqueness across all requests</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="782" data-linenumber="168">
            
              <span class="hits">782</span>
            

            

            <code class="ruby">    current_codes.each do |code|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            

            <code class="ruby">      # Find all requests that contain this code (excluding current request)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            

            <code class="ruby">      # Use LIKE with UPPER for PostgreSQL compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="802" data-linenumber="171">
            
              <span class="hits">802</span>
            

            

            <code class="ruby">      conflicting_requests = self.class.where.not(id: id).where(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            

            <code class="ruby">        &quot;UPPER(promo_code) LIKE ?&quot;, &quot;%#{code.upcase}%&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            

            <code class="ruby">      ).select do |request|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="174">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">        request.promo_codes_array.map(&amp;:upcase).include?(code.upcase)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="802" data-linenumber="177">
            
              <span class="hits">802</span>
            

            

            <code class="ruby">      if conflicting_requests.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="178">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">        conflicting_request = conflicting_requests.first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="179">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">        errors.add(:promo_code, &quot;  \&quot;#{code}\&quot;,      &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            

            <code class="ruby">                                &quot; \&quot;#{conflicting_request.request_type_label}\&quot; (ID: #{conflicting_request.id})&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="185">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def no_spaces_in_stag_and_codes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="789" data-linenumber="186">
            
              <span class="hits">789</span>
            

            

            <code class="ruby">    if stag.present? &amp;&amp; stag.include?(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="187">
            

            

            <code class="ruby">      errors.add(:stag, &quot;   &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="789" data-linenumber="190">
            
              <span class="hits">789</span>
            

            

            <code class="ruby">    if promo_code.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1584" data-linenumber="191">
            
              <span class="hits">1584</span>
            

            

            <code class="ruby">      codes_with_spaces = promo_codes_array.select { |code| code.include?(&quot; &quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="782" data-linenumber="192">
            
              <span class="hits">782</span>
            

            

            <code class="ruby">      if codes_with_spaces.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="193">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">        errors.add(:promo_code, &quot;   : #{codes_with_spaces.join(&#39;, &#39;)}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="198">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def valid_promo_codes_format</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="790" data-linenumber="199">
            
              <span class="hits">790</span>
            

            

            <code class="ruby">    return if promo_code.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="783" data-linenumber="201">
            
              <span class="hits">783</span>
            

            

            <code class="ruby">    codes = promo_codes_array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="783" data-linenumber="202">
            
              <span class="hits">783</span>
            

            

            <code class="ruby">    if codes.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="203">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      errors.add(:promo_code, &quot;      &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="204">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            

            <code class="ruby">    # Check for valid code format (alphanumeric and underscores only)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1584" data-linenumber="208">
            
              <span class="hits">1584</span>
            

            

            <code class="ruby">    invalid_codes = codes.select { |code| code !~ /\A[A-Z0-9_]+\z/i }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="782" data-linenumber="209">
            
              <span class="hits">782</span>
            

            

            <code class="ruby">    if invalid_codes.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="210">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      errors.add(:promo_code, &quot;    : #{invalid_codes.join(&#39;, &#39;)}. &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            

            <code class="ruby">                              &quot;  ,   .&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="746251adf3fce651fef008adcb58338f2b2ec9a9">
  <div class="header">
    <h3>app/models/material_prize_reward.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>10</b> relevant lines.
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class MaterialPrizeReward &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  include BonusCommonParameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :bonus</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :prize_name, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :prize_value, numericality: { greater_than_or_equal_to: 0 }, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def formatted_prize_value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="10">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">    return &quot;N/A&quot; if prize_value.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="11">
            
              <span class="hits">20</span>
            

            

            <code class="ruby">    &quot;#{prize_value} #{bonus.currency}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def has_monetary_value?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="15">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">    prize_value.present? &amp;&amp; prize_value &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
